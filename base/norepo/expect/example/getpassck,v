head	5.1;
access;
symbols
	expect_5_45:5.1
	expect_6_branch:5.1.0.2
	expect_5_44_1_15:5.1;
locks; strict;
comment	@# @;


5.1
date	2007.06.28.19.23.40;	author andreas_kupries;	state Exp;
branches;
next	;


desc
@@


5.1
log
@
	* Merged changes from the official version 5.44.1 of expect into
	  the SF sources. See the details below.

	  --------------------
	  Marius Schamsula <marius173@@mchsi.xcom> reported tclconfig
	  missing, evidentally for new TEA.

	  Lots of massaging to fix TEAification of Makefile and configure
	  including that version numbers will now be full three part.

	  Daniel Wong <danielwong@@berkeley.xedu> noted the home page
	  should note that Wikipedia has a very readable entry for Expect.

	  Andre Alves <aalves@@escloyalty.xcom> noted passmass needed some
	  fixes to handle Solaris 9 passwd prompt changes.

	  Andreas fixed several things: changes to better support TEA, fix
	  debugger interaction with nonblocking mode, and probably other
	  things I'm overlooking.

	  Martin Dietze <di@@fh-wedel.xde> noted that autoconf 2.59 is
	  confused by C comment after undefs in expect_cf.h.in.

	  Added additional code to unbuffer -p so that if a process
	  earlier in the pipeline exits, unbuffer attempts to recover any
	  remaining output from the spawned proc before unbuffer itself
	  exits.

	  Jeffrey Hobbs noted that once stty was called, a bg'd script
	  would be suspended at exit.  Turned out to be overaggressive
	  code in stty that recorded what 'damage' the user might have
	  caused when calling stty in the first place.

	  Jens Petersen provided patch to make setpgrp configure better on
	  some Linux systems.

	  Added example/getpassck script to test for getpass bug.

	  multixterm had debugging stuff leftover ("hello").
	  --------------------
@
text
@#!/bin/sh
# \
exec expect "$0" ${1+"$@@"}
#
# Name: getpassck
#
# Description:
#    This script demonstrates when programs using getpass sometimes
#    fail.  The reason is that some implementations of getpass prompt
#    before the pty/tty has completed the switch to no-echo.  This may
#    not be obvious from examination of the implementation of getpass
#    itself because the driver itself may cut corners and be
#    responsible for allowing the call to return prematurely.
#
# Directions:
#   Simply run this script.  It will loop 100 times attempting to
#   generate the getpass problem.  If the bug cannot be reproduced,
#   you will see 100 failed attempts to su.  If the bug can be
#   reproduced, the script exits as soon as it is detected.
#
# Author: Don Libes <don@@libes.com>
# Version: 1.0, Wed Mar  9 12:36:12 EST 2005
# 

for {set i 0} {$i < 100} {incr i} {
 spawn -noecho su
 expect ": "      ;# get password prompt as quickly as possible
 send "X\r"       ;# send password
 expect X {
  puts "Password was echoed!  This system has the getpass problem."
  exit
 } "orry" {
  close
  wait
 }
}
puts "Failed to reproduce getpass problem."
@
