head	1.1;
access;
symbols
	win32-jump-point-1:1.1.4.6
	telco-tec-win32-take2-branch:1.1.0.4
	telco-tec-win32-branch:1.1.0.2;
locks; strict;
comment	@ * @;


1.1
date	2001.11.07.10.04.57;	author davygrvy;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2001.11.07.10.04.57;	author davygrvy;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2001.11.09.01.17.40;	author davygrvy;	state Exp;
branches;
next	;

1.1.4.1
date	2002.02.10.02.59.46;	author davygrvy;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2002.02.10.06.25.50;	author davygrvy;	state Exp;
branches;
next	1.1.4.3;

1.1.4.3
date	2002.02.10.12.03.30;	author davygrvy;	state Exp;
branches;
next	1.1.4.4;

1.1.4.4
date	2002.03.06.01.51.53;	author davygrvy;	state Exp;
branches;
next	1.1.4.5;

1.1.4.5
date	2002.03.09.01.17.29;	author davygrvy;	state Exp;
branches;
next	1.1.4.6;

1.1.4.6
date	2002.03.09.05.48.51;	author davygrvy;	state Exp;
branches;
next	1.1.4.7;

1.1.4.7
date	2003.08.25.23.17.49;	author davygrvy;	state Exp;
branches;
next	1.1.4.8;

1.1.4.8
date	2003.08.26.20.46.52;	author davygrvy;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file expWinInt.h was initially added on branch telco-tec-win32-branch.
@
text
@@


1.1.4.1
log
@moved all header files over to a more core style with the beginnings of a
Stubs table.  This work is far from complete.
@
text
@a0 134
/* ----------------------------------------------------------------------------
 * expWinInt.h --
 *
 *	Declarations of Windows-specific shared variables and procedures.
 *
 * ----------------------------------------------------------------------------
 *
 * Written by: Don Libes, libes@@cme.nist.gov, NIST, 12/3/90
 * 
 * Design and implementation of this program was paid for by U.S. tax
 * dollars.  Therefore it is public domain.  However, the author and NIST
 * would appreciate credit if this program or parts of it are used.
 * 
 * Copyright (c) 1997 Mitel Corporation
 *	work by Gordon Chaffee <chaffee@@bmrc.berkeley.edu> for the WinNT port.
 *
 * Copyright (c) 2002 Telindustrie, LLC
 *	work by David Gravereaux <davygrvy@@pobox.com> for any Win32 OS.
 *
 * ----------------------------------------------------------------------------
 * URLs:    http://expect.nist.gov/
 *	    http://expect.sf.net/
 *	    http://bmrc.berkeley.edu/people/chaffee/expectnt.html
 * ----------------------------------------------------------------------------
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.2.2 2001/11/09 01:17:40 davygrvy Exp $
 * ----------------------------------------------------------------------------
 */
#ifndef _EXPWININT
#define _EXPWININT

#ifndef _EXPINT
#   ifndef _EXP
	/* Ask windows.h to be agressive about the HANDLE type. */
#	define STRICT
	/* make sure we get the Win95 API */
#	define WINVER 0x0400
#	ifdef _DEBUG
	    /* Make sure we add the WinNT API for IsDebuggerPresent(). */
#	    define _WIN32_WINNT 0x0400
#	endif
#   endif
#   include "expInt.h"
#endif

#ifndef _EXPPORT
#   include "expPort.h"
#endif

#undef TCL_STORAGE_CLASS
#if defined(BUILD_spawndriver)
#   define TCL_STORAGE_CLASS
extern TCL_CPP void ExpInitWinProcessAPI (void);
extern TCL_CPP void ExpDynloadTclStubs (void);
#   include "expWinSlave.hpp"
#   include "spawndrvmc.h"
#elif defined(BUILD_exp)
#   define TCL_STORAGE_CLASS DLLEXPORT
#else
#   ifdef USE_EXP_STUBS
#	define TCL_STORAGE_CLASS
#   else
#	define TCL_STORAGE_CLASS DLLIMPORT
#   endif
#endif


#define EXP_SLAVE_CREATE 'c'
#define EXP_SLAVE_KEY    'k'
#define EXP_SLAVE_MOUSE  'm'
#define EXP_SLAVE_WRITE  'w'
#define EXP_SLAVE_KILL   'x'

/*
 * Define the types of attempts to use to kill the subprocess
 */
#define EXP_KILL_TERMINATE  0x1
#define EXP_KILL_CTRL_C     0x2
#define EXP_KILL_CTRL_BREAK 0x4

#define EXP_LOG(format, args) \
    ExpSyslog("Expect SlaveDriver (%s: %d): " format, __FILE__, __LINE__, args)

/*
 * The following defines identify the various types of applications that 
 * run under windows.  There is special case code for the various types.
 */

#define EXP_APPL_NONE	    0
#define EXP_APPL_BATCH	    1
#define EXP_APPL_DOS16	    2
#define EXP_APPL_OS2	    3
#define EXP_APPL_OS2DRV	    4
#define EXP_APPL_WIN16	    5
#define EXP_APPL_WIN16DRV   6
#define EXP_APPL_WIN32CUI   7
#define EXP_APPL_WIN32GUI   8
#define EXP_APPL_WIN32DLL   9
#define EXP_APPL_WIN32DRV   10
#define EXP_APPL_WIN64CUI   11
#define EXP_APPL_WIN64GUI   12
#define EXP_APPL_WIN64DLL   13
#define EXP_APPL_WIN64DRV   14


extern HMODULE expDllInstance;

typedef struct {
    int useWide;
    HANDLE (WINAPI *createFileProc)(LPCTSTR, DWORD, DWORD,
	    LPSECURITY_ATTRIBUTES, DWORD, DWORD, HANDLE);
    BOOL (WINAPI *createProcessProc)(LPCTSTR, LPTSTR, LPSECURITY_ATTRIBUTES,
	    LPSECURITY_ATTRIBUTES, BOOL, DWORD, LPVOID, LPCTSTR, LPSTARTUPINFO,
	    LPPROCESS_INFORMATION);
    DWORD (WINAPI *getFileAttributesProc)(LPCTSTR);
    DWORD (WINAPI *getShortPathNameProc)(LPCTSTR, LPTSTR, DWORD); 
    DWORD (WINAPI *searchPathProc)(LPCTSTR, LPCTSTR, LPCTSTR, DWORD, LPTSTR,
	    LPTSTR *);
    VOID (WINAPI *outputDebugStringProc)(LPCTSTR);
    DWORD (WINAPI *getModuleFileNameProc)(HMODULE, LPTSTR, DWORD);
    BOOL (WINAPI *setEnvironmentVariableProc)(LPCTSTR, LPCTSTR);
    BOOL (WINAPI *getEnvironmentVariableProc)(LPCTSTR, LPTSTR, DWORD);
    LONG (WINAPI *regSetValueExProc)(HKEY, LPCTSTR, DWORD, DWORD, CONST BYTE *,
	    DWORD);
} ExpWinProcs;

extern ExpWinProcs *expWinProcs;


#include "expIntPlatDecls.h"

#undef TCL_STORAGE_CLASS
#define TCL_STORAGE_CLASS DLLIMPORT

#endif /* _EXPWININT */
@


1.1.4.2
log
@moved all header files over to a more core style with the beginnings of a
Stubs table.  This work is far from complete.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.1 2002/02/10 02:59:46 davygrvy Exp $
d54 2
a55 5
#   include "expWinSlave.h"
#   ifdef _DEBUG
#	include "MsvcDbgControl.h"
#   endif
/*#   include "spawndrvmc.h"*/
@


1.1.4.3
log
@All file comments have the same form.
@
text
@d17 1
a17 1
 * Copyright (c) 2001-2002 Telindustrie, LLC
d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.2 2002/02/10 06:25:50 davygrvy Exp $
@


1.1.4.4
log
@Our main() for the slave driver is getting a deep rewrite.  This shell has a
good structure.  The outer edges are in process.  slavedrv.exe currently
won't link at this time.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.3 2002/02/10 12:03:30 davygrvy Exp $
d50 1
a50 1
#if defined(BUILD_slavedriver)
d52 3
a54 1
#   include "expWinSlave.hpp"
@


1.1.4.5
log
@Almost linkable again.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.4 2002/03/06 01:51:53 davygrvy Exp $
d127 1
a127 1
extern TCL_CPP ExpWinProcs *expWinProcs;
@


1.1.4.6
log
@Got error codes working.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.5 2002/03/09 01:17:29 davygrvy Exp $
d56 1
a56 1
#   include "slavedrvmc.h"
d81 2
a82 9
//#define EXP_LOG(format, args) \
//    ExpSyslog("Expect SlaveDriver (%s: %d): " format, __FILE__, __LINE__, args)

/*
 * Errors and logging
 */
#define EXP_LOG0(errCode)		ExpWinSyslog(errCode, __FILE__, (int)__LINE__, 0)
#define EXP_LOG1(errCode, arg1)		ExpWinSyslog(errCode, __FILE__, (int)__LINE__, arg1, 0)
#define EXP_LOG2(errCode, arg1, arg2)	ExpWinSyslog(errCode, __FILE__, (int)__LINE__, arg1, arg2, 0)
@


1.1.4.7
log
@these uncommitted edits have been sitting on my desktop for an eternity.

Adds some MS-DOS support but fails to deliver the required hooks to
succeed.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.6 2002/03/09 05:48:51 davygrvy Exp $
d51 6
a56 2
//#   define TCL_STORAGE_CLASS
//#   include "expWinSlave.hpp"
a58 1
#   include "slavedrvmc.h"  /* error code constants */
d134 1
a134 1
TCL_EXTRNC ExpWinProcs *expWinProcs;
@


1.1.4.8
log
@titleblock comment changes and removal of the Detours library usage.
@
text
@a17 1
 * Copyright (c) 2003 ActiveState Corporation
d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.4.7 2003/08/25 23:17:49 davygrvy Exp $
@


1.1.2.1
log
@Numerous changes
@
text
@a0 84
/* ----------------------------------------------------------------------------
 * expWinInt.h --
 *
 *	Declarations of Windows-specific shared variables and procedures.
 *
 * ----------------------------------------------------------------------------
 *
 * Written by: Don Libes, libes@@cme.nist.gov, NIST, 12/3/90
 * 
 * Design and implementation of this program was paid for by U.S. tax
 * dollars.  Therefore it is public domain.  However, the author and NIST
 * would appreciate credit if this program or parts of it are used.
 * 
 * Copyright (c) 1997 Mitel Corporation
 *	work by Gordon Chaffee <chaffee@@bmrc.berkeley.edu> for the WinNT port.
 *
 * Copyright (c) 2001 Telindustrie, LLC
 *	work by David Gravereaux <davygrvy@@pobox.com> for any Win32 OS.
 *
 * ----------------------------------------------------------------------------
 * URLs:    http://expect.nist.gov/
 *	    http://expect.sf.net/
 *	    http://bmrc.berkeley.edu/people/chaffee/expectnt.html
 * ----------------------------------------------------------------------------
 * RCS: @@(#) $Id: exp.h,v 1.1.2.5 2001/10/29 06:40:29 davygrvy Exp $
 * ----------------------------------------------------------------------------
 */
#ifndef _EXPWININT
#define _EXPWININT

#ifndef _EXPINT
#   ifndef _EXP
#	define STRICT		    /* Ask windows.h to be agressive about the HANDLE type. */
#	define WINVER 0x0400	    /* Make sure we get the Win95 API. */
#   endif
#   include "expInt.h"
#endif

#ifndef _EXPPORT
#   include "expPort.h"
#endif

#undef TCL_STORAGE_CLASS
#if defined(BUILD_spawndriver)
#   define TCL_STORAGE_CLASS
extern TCL_CPP void ExpInitWinProcessAPI (void);
extern TCL_CPP void ExpDynloadTclStubs (void);
#   include "expWinSlave.h"
#   include "spawndrvmc.h"
#elif defined(BUILD_exp)
#   define TCL_STORAGE_CLASS DLLEXPORT
#else
#   ifdef USE_EXP_STUBS
#	define TCL_STORAGE_CLASS
#   else
#	define TCL_STORAGE_CLASS DLLIMPORT
#   endif
#endif


typedef struct {
    int useWide;
    HANDLE (WINAPI *createFileProc)(CONST TCHAR *, DWORD, DWORD, 
	    LPSECURITY_ATTRIBUTES, DWORD, DWORD, HANDLE);
    BOOL (WINAPI *createProcessProc)(CONST TCHAR *, TCHAR *, 
	    LPSECURITY_ATTRIBUTES, LPSECURITY_ATTRIBUTES, BOOL, DWORD, 
	    LPVOID, CONST TCHAR *, LPSTARTUPINFO, LPPROCESS_INFORMATION);
    DWORD (WINAPI *getFileAttributesProc)(CONST TCHAR *);
    DWORD (WINAPI *getShortPathNameProc)(CONST TCHAR *, TCHAR *, DWORD); 
    DWORD (WINAPI *searchPathProc)(CONST TCHAR *, CONST TCHAR *, 
	    CONST TCHAR *, DWORD, TCHAR *, TCHAR **);
} ExpWinProcs;


extern ExpWinProcs *expWinProcs;



#include "expIntPlatDecls.h"

#undef TCL_STORAGE_CLASS
#define TCL_STORAGE_CLASS DLLIMPORT

#endif /* _EXPWININT */
@


1.1.2.2
log
@beginning the C++ rewrite.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInt.h,v 1.1.2.1 2001/11/07 10:04:57 davygrvy Exp $
d48 1
a48 1
#   include "expWinSlave.hpp"
@


