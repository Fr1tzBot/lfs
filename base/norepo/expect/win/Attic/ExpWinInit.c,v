head	1.1;
access;
symbols
	win32-jump-point-1:1.1.4.4
	telco-tec-win32-take2-branch:1.1.0.4
	telco-tec-win32-branch:1.1.0.2;
locks; strict;
comment	@ * @;


1.1
date	2001.11.07.10.04.57;	author davygrvy;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2001.11.07.10.04.57;	author davygrvy;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2001.11.07.22.10.39;	author davygrvy;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2001.11.09.01.17.40;	author davygrvy;	state Exp;
branches;
next	;

1.1.4.1
date	2002.02.10.06.41.28;	author davygrvy;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2002.02.10.12.03.30;	author davygrvy;	state Exp;
branches;
next	1.1.4.3;

1.1.4.3
date	2002.02.11.09.56.00;	author davygrvy;	state Exp;
branches;
next	1.1.4.4;

1.1.4.4
date	2002.02.16.03.16.59;	author davygrvy;	state Exp;
branches;
next	1.1.4.5;

1.1.4.5
date	2003.08.26.20.46.52;	author davygrvy;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file expWinInit.c was initially added on branch telco-tec-win32-branch.
@
text
@@


1.1.4.1
log
@fixing filename case problem
@
text
@a0 61
#include "expWinInt.h"

static ExpWinProcs asciiProcs = {
    0,
    (HANDLE (WINAPI *)(LPCTSTR, DWORD, DWORD, SECURITY_ATTRIBUTES *, 
	    DWORD, DWORD, HANDLE)) CreateFileA,
    (BOOL (WINAPI *)(LPCTSTR, LPTSTR, LPSECURITY_ATTRIBUTES, 
	    LPSECURITY_ATTRIBUTES, BOOL, DWORD, LPVOID, LPCTSTR, 
	    LPSTARTUPINFO, LPPROCESS_INFORMATION)) CreateProcessA,
    (DWORD (WINAPI *)(LPCTSTR)) GetFileAttributesA,
    (DWORD (WINAPI *)(LPCTSTR, LPTSTR, DWORD)) GetShortPathNameA,
    (DWORD (WINAPI *)(LPCTSTR, LPCTSTR, LPCTSTR, DWORD, 
	    LPTSTR, LPTSTR *)) SearchPathA,
    (VOID (WINAPI *)(LPCTSTR)) OutputDebugStringA,
    (DWORD (WINAPI *)(HMODULE, LPTSTR, DWORD)) GetModuleFileNameA,
    (BOOL (WINAPI *)(LPCTSTR, LPCTSTR)) SetEnvironmentVariableA,
    (BOOL (WINAPI *)(LPCTSTR, LPTSTR, DWORD)) GetEnvironmentVariableA,
    (LONG (WINAPI *)(HKEY, LPCTSTR, DWORD, DWORD, CONST BYTE *,
	    DWORD)) RegSetValueExA
};

static ExpWinProcs unicodeProcs = {
    1,
    (HANDLE (WINAPI *)(LPCTSTR, DWORD, DWORD, SECURITY_ATTRIBUTES *, 
	    DWORD, DWORD, HANDLE)) CreateFileW,
    (BOOL (WINAPI *)(LPCTSTR, LPTSTR, LPSECURITY_ATTRIBUTES, 
	    LPSECURITY_ATTRIBUTES, BOOL, DWORD, LPVOID, LPCTSTR, 
	    LPSTARTUPINFO, LPPROCESS_INFORMATION)) CreateProcessW,
    (DWORD (WINAPI *)(LPCTSTR)) GetFileAttributesW,
    (DWORD (WINAPI *)(LPCTSTR, LPTSTR, DWORD)) GetShortPathNameW,
    (DWORD (WINAPI *)(LPCTSTR, LPCTSTR, LPCTSTR, DWORD, 
	    LPTSTR, LPTSTR *)) SearchPathW,
    (VOID (WINAPI *)(LPCTSTR)) OutputDebugStringW,
    (DWORD (WINAPI *)(HMODULE, LPTSTR, DWORD)) GetModuleFileNameW,
    (BOOL (WINAPI *)(LPCTSTR, LPCTSTR)) SetEnvironmentVariableW,
    (BOOL (WINAPI *)(LPCTSTR, LPTSTR, DWORD)) GetEnvironmentVariableW,
    (LONG (WINAPI *)(HKEY, LPCTSTR, DWORD, DWORD, CONST BYTE *,
	    DWORD)) RegSetValueExW
};

ExpWinProcs *expWinProcs = &asciiProcs;

/*
 *----------------------------------------------------------------------
 *  ExpWinInit --
 *
 *	Switches to the correct native API at run-time.  Works in
 *	tandem with Tcl_WinUtfToTchar().
 *
 *  Returns:
 *	nothing.
 *
 *----------------------------------------------------------------------
 */
void
ExpWinInit(void)
{
    if (TclWinGetPlatformId() == VER_PLATFORM_WIN32_NT) {    
	expWinProcs = &unicodeProcs;
    }
}
@


1.1.4.2
log
@All file comments have the same form.
@
text
@a0 28
/* ----------------------------------------------------------------------------
 * expWinInit.c --
 *
 *	OS specific inits.
 *
 * ----------------------------------------------------------------------------
 *
 * Written by: Don Libes, libes@@cme.nist.gov, NIST, 12/3/90
 * 
 * Design and implementation of this program was paid for by U.S. tax
 * dollars.  Therefore it is public domain.  However, the author and NIST
 * would appreciate credit if this program or parts of it are used.
 * 
 * Copyright (c) 1997 Mitel Corporation
 *	work by Gordon Chaffee <chaffee@@bmrc.berkeley.edu> for the WinNT port.
 *
 * Copyright (c) 2001-2002 Telindustrie, LLC
 *	work by David Gravereaux <davygrvy@@pobox.com> for any Win32 OS.
 *
 * ----------------------------------------------------------------------------
 * URLs:    http://expect.nist.gov/
 *	    http://expect.sf.net/
 *	    http://bmrc.berkeley.edu/people/chaffee/expectnt.html
 * ----------------------------------------------------------------------------
 * RCS: @@(#) $Id: exp.h,v 1.1.4.4 2002/02/10 10:17:04 davygrvy Exp $
 * ----------------------------------------------------------------------------
 */

@


1.1.4.3
log
@Can now build for Stubs and provide a Stubs table, too,  WeeHoo..
@
text
@d4 1
a4 1
 *	Win OS specific inits.
d25 1
a25 1
 * RCS: @@(#) $Id: expWinInit.c,v 1.1.4.2 2002/02/10 12:03:30 davygrvy Exp $
a69 1
tclWinMakeFileProcType tclWinMakeFileProc;
a88 4

    /* need TclWinMakeFile() from the outside... bastards! */
    tclWinMakeFileProc = (tclWinMakeFileProcType)
	    GetProcAddress(TclWinGetTclInstance(), "TclWinMakeFile");
@


1.1.4.4
log
@A static build issue.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInit.c,v 1.1.4.3 2002/02/11 09:56:00 davygrvy Exp $
d91 1
a91 1
    /* need TclWinMakeFile() from the outside... los bastards! */
a93 5

#ifdef STATIC_BUILD
    /* this may not be correct, but closer than not */
    expDllInstance = TclWinGetTclInstance();
#endif
@


1.1.4.5
log
@titleblock comment changes and removal of the Detours library usage.
@
text
@a17 1
 * Copyright (c) 2003 ActiveState Corporation
d25 1
a25 1
 * RCS: @@(#) $Id: expWinInit.c,v 1.1.4.4 2002/02/16 03:16:59 davygrvy Exp $
@


1.1.2.1
log
@Numerous changes
@
text
@a0 46
#include "expWinInt.h"

static ExpWinProcs asciiProcs = {
    0,
    (HANDLE (WINAPI *)(CONST TCHAR *, DWORD, DWORD, SECURITY_ATTRIBUTES *, 
	    DWORD, DWORD, HANDLE)) CreateFileA,
    (BOOL (WINAPI *)(CONST TCHAR *, TCHAR *, LPSECURITY_ATTRIBUTES, 
	    LPSECURITY_ATTRIBUTES, BOOL, DWORD, LPVOID, CONST TCHAR *, 
	    LPSTARTUPINFO, LPPROCESS_INFORMATION)) CreateProcessA,
    (DWORD (WINAPI *)(CONST TCHAR *)) GetFileAttributesA,
    (DWORD (WINAPI *)(CONST TCHAR *, TCHAR *, DWORD)) GetShortPathNameA,
    (DWORD (WINAPI *)(CONST TCHAR *, CONST TCHAR *, CONST TCHAR *, DWORD, 
	    TCHAR *, TCHAR **)) SearchPathA
};

static ExpWinProcs unicodeProcs = {
    1,
    (HANDLE (WINAPI *)(CONST TCHAR *, DWORD, DWORD, SECURITY_ATTRIBUTES *, 
	    DWORD, DWORD, HANDLE)) CreateFileW,
    (BOOL (WINAPI *)(CONST TCHAR *, TCHAR *, LPSECURITY_ATTRIBUTES, 
	    LPSECURITY_ATTRIBUTES, BOOL, DWORD, LPVOID, CONST TCHAR *, 
	    LPSTARTUPINFO, LPPROCESS_INFORMATION)) CreateProcessW,
    (DWORD (WINAPI *)(CONST TCHAR *)) GetFileAttributesW,
    (DWORD (WINAPI *)(CONST TCHAR *, TCHAR *, DWORD)) GetShortPathNameW,
    (DWORD (WINAPI *)(CONST TCHAR *, CONST TCHAR *, CONST TCHAR *, DWORD, 
	    TCHAR *, TCHAR **)) SearchPathW
};

ExpWinProcs *expWinProcs = &asciiProcs;


void
ExpWinInit (void)
{
    OSVERSIONINFO os;
    os.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
    
    if (GetVersionEx(&os) != 0) {    
	switch (os.dwPlatformId) {
	    case VER_PLATFORM_WIN32_WINDOWS:
		expWinProcs = &asciiProcs; break;
	    case VER_PLATFORM_WIN32_NT:
		expWinProcs = &unicodeProcs; break;
	}
    }
}
@


1.1.2.2
log
@More trims for unicode, but I'm dropping the attempt to build for unicode.
Too much wierd stuff to handle along with tchar.h having a C++ bug
that I don't understand why overloading is problematic.
@
text
@a0 28
/* ----------------------------------------------------------------------------
 * expWinInit.c --
 *
 *	Contains startup code needed for the Expect extension on Windows.
 *
 * ----------------------------------------------------------------------------
 *
 * Written by: Don Libes, libes@@cme.nist.gov, NIST, 12/3/90
 * 
 * Design and implementation of this program was paid for by U.S. tax
 * dollars.  Therefore it is public domain.  However, the author and NIST
 * would appreciate credit if this program or parts of it are used.
 * 
 * Copyright (c) 1997 Mitel Corporation
 *	work by Gordon Chaffee <chaffee@@bmrc.berkeley.edu> for the WinNT port.
 *
 * Copyright (c) 2001 Telindustrie, LLC
 *	work by David Gravereaux <davygrvy@@pobox.com> for any Win32 OS.
 *
 * ----------------------------------------------------------------------------
 * URLs:    http://expect.nist.gov/
 *	    http://expect.sf.net/
 *	    http://bmrc.berkeley.edu/people/chaffee/expectnt.html
 * ----------------------------------------------------------------------------
 * RCS: @@(#) $Id: expWinLog.c,v 1.1.2.5 2001/11/07 10:04:57 davygrvy Exp $
 * ----------------------------------------------------------------------------
 */

a31 12
/*
 *----------------------------------------------------------------------
 *  ExpWinInit --
 *
 *	Switches to the correct native API at run-time.  Works in
 *	tandem with Tcl_WinUtfToTchar().
 *
 *  Returns:
 *	nothing.
 *
 *----------------------------------------------------------------------
 */
@


1.1.2.3
log
@beginning the C++ rewrite.
@
text
@d25 1
a25 1
 * RCS: @@(#) $Id: expWinInit.c,v 1.1.2.2 2001/11/07 22:10:39 davygrvy Exp $
d75 10
a84 4
    if (TclWinGetPlatformId() == VER_PLATFORM_WIN32_NT) {    
	expWinProcs = &unicodeProcs;
    } else {
	expWinProcs = &asciiProcs;
@


