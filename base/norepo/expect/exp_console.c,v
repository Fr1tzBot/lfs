head	5.32;
access;
symbols
	expect_5_45:5.32
	expect_6_branch:5.32.0.2
	expect_5_44_1_15:5.32
	activestate_win32_port_start:5.29
	telco-tec-win32-take2-branch:5.29.0.6
	telco-tec-win32-branch:5.29.0.4
	expect-sf418892-sf439042-branch:5.29.0.2
	tclpro-1-5-0:5.29
	tclpro-1-4-1:5.29
	tclpro-1-4-0:5.29
	expect-5-32-2:5.29
	expect-5-32-0:5.29
	ajuba-ajuba2-2-0:5.28.1.1.2.2
	scriptics-sc-2-0-b5:5.28.1.1.2.2
	scriptics-sc-2-0-fixed:5.28.1.1.2.2
	scriptics-sc-2-0-b2:5.28.1.1.2.2
	scriptics-sc-2-0-b1:5.28.1.1.2.2
	scriptics-sc-1-1:5.28.1.1.2.2
	scriptics-sc-1-1-b1:5.28.1.1.2.2
	scriptics-sc-1-1-branch:5.28.1.1.2.2.0.4
	scriptics-sc-1-1-base:5.28.1.1.2.2
	scriptics-sc-1-0:5.28.1.1.2.2
	scriptics-sc-1-0-branch:5.28.1.1.2.2.0.2
	scriptics-sc-1-0-base:5.28.1.1.2.2
	expect-5-31-3:5.28.1.1.2.2
	scriptics-bc-1-0-b1:5.28.1.1.2.2
	scriptics-tclpro-1-3-0:5.28.1.1.2.2
	scriptics-tclpro-1-3-b4:5.28.1.1.2.2
	scriptics-tclpro-1-3-b3:5.28.1.1.2.2
	expect-5-31:5.28.1.1.2.2
	expect-5-31-branch:5.28.1.1.0.2
	expect-5-31-base:5.28.1.1
	scriptics-tclpro-1-2:5.28.1.1
	scriptics-tclpro-1-2-b2:5.28.1.1
	scriptics-tclpro-1-2-b1:5.28.1.1
	scriptics-tclpro-1-2-a1:5.28.1.1
	expect-5-28-1:5.28.1.1
	expect:5.28.1;
locks; strict;
comment	@ * @;


5.32
date	2010.07.01.00.53.49;	author eee;	state Exp;
branches;
next	5.31;

5.31
date	2010.03.15.23.17.39;	author eee;	state Exp;
branches;
next	5.30;

5.30
date	2007.06.28.19.23.38;	author andreas_kupries;	state Exp;
branches;
next	5.29;

5.29
date	2000.01.06.23.22.03;	author wart;	state Exp;
branches
	5.29.4.1
	5.29.6.1;
next	5.28;

5.28
date	98.10.14.22.53.21;	author cvsadmin;	state Exp;
branches
	5.28.1.1;
next	;

5.28.1.1
date	98.10.14.22.53.21;	author cvsadmin;	state Exp;
branches
	5.28.1.1.2.1;
next	;

5.28.1.1.2.1
date	99.06.14.20.36.47;	author don;	state Exp;
branches;
next	5.28.1.1.2.2;

5.28.1.1.2.2
date	99.06.15.22.52.56;	author don;	state Exp;
branches;
next	;

5.29.4.1
date	2001.10.02.23.04.51;	author davygrvy;	state dead;
branches;
next	;

5.29.6.1
date	2001.11.22.08.50.37;	author davygrvy;	state dead;
branches;
next	;


desc
@@


5.32
log
@Undoing all changes made by me during ANSIfication attempt, and
reverting to tag 'expect_5_44_1_15'.  Further ANSIfication will
be pursued on a branch.
@
text
@/* exp_console.c - grab console.  This stuff is in a separate file to
avoid unpleasantness of AIX (3.2.4) .h files which provide no way to
reference TIOCCONS and include both sys/ioctl.h and sys/sys/stropts.h
without getting some sort of warning from the compiler.  The problem
is that both define _IO but only ioctl.h checks to see if it is
defined first.  This would suggest that it is sufficient to include
ioctl.h after stropts.h.  Unfortunately, ioctl.h, having seen that _IO
is defined, then fails to define other important things (like _IOW).

Written by: Don Libes, NIST, 2/6/90

Design and implementation of this program was paid for by U.S. tax
dollars.  Therefore it is public domain.  However, the author and NIST
would appreciate credit if this program or parts of it are used.
*/

#include "expect_cf.h"
#include <stdio.h>
#include <sys/types.h>
#include <sys/ioctl.h>

/* Solaris needs this for console redir */
#ifdef HAVE_STRREDIR_H
#include <sys/strredir.h>
# ifdef SRIOCSREDIR
#  undef TIOCCONS
# endif
#endif

#ifdef HAVE_SYS_FCNTL_H
#include <sys/fcntl.h>
#endif

#include "tcl.h"
#include "exp_rename.h"
#include "exp_prog.h"
#include "exp_command.h"
#include "exp_log.h"

static void
exp_console_manipulation_failed(s)
char *s;
{
    expErrorLog("expect: spawn: cannot %s console, check permissions of /dev/console\n",s);
    exit(-1);
}

void
exp_console_set()
{
#ifdef SRIOCSREDIR
	int fd;

	if ((fd = open("/dev/console", O_RDONLY)) == -1) {
		exp_console_manipulation_failed("open");
	}
	if (ioctl(fd, SRIOCSREDIR, 0) == -1) {
		exp_console_manipulation_failed("redirect");
	}
	close(fd);
#endif

#ifdef TIOCCONS
	int on = 1;

	if (ioctl(0,TIOCCONS,(char *)&on) == -1) {
		exp_console_manipulation_failed("redirect");
	}
#endif /*TIOCCONS*/
}
@


5.31
log
@ANSIfication changes.
@
text
@d41 2
a42 1
exp_console_manipulation_failed(char *s)
d49 1
a49 1
exp_console_set(void)
@


5.30
log
@
	* Merged changes from the official version 5.44.1 of expect into
	  the SF sources. See the details below.

	  --------------------
	  Marius Schamsula <marius173@@mchsi.xcom> reported tclconfig
	  missing, evidentally for new TEA.

	  Lots of massaging to fix TEAification of Makefile and configure
	  including that version numbers will now be full three part.

	  Daniel Wong <danielwong@@berkeley.xedu> noted the home page
	  should note that Wikipedia has a very readable entry for Expect.

	  Andre Alves <aalves@@escloyalty.xcom> noted passmass needed some
	  fixes to handle Solaris 9 passwd prompt changes.

	  Andreas fixed several things: changes to better support TEA, fix
	  debugger interaction with nonblocking mode, and probably other
	  things I'm overlooking.

	  Martin Dietze <di@@fh-wedel.xde> noted that autoconf 2.59 is
	  confused by C comment after undefs in expect_cf.h.in.

	  Added additional code to unbuffer -p so that if a process
	  earlier in the pipeline exits, unbuffer attempts to recover any
	  remaining output from the spawned proc before unbuffer itself
	  exits.

	  Jeffrey Hobbs noted that once stty was called, a bg'd script
	  would be suspended at exit.  Turned out to be overaggressive
	  code in stty that recorded what 'damage' the user might have
	  caused when calling stty in the first place.

	  Jens Petersen provided patch to make setpgrp configure better on
	  some Linux systems.

	  Added example/getpassck script to test for getpass bug.

	  multixterm had debugging stuff leftover ("hello").
	  --------------------
@
text
@d41 1
a41 2
exp_console_manipulation_failed(s)
char *s;
d48 1
a48 1
exp_console_set()
@


5.29
log
@Merge of expect5-31-branch to mainline
@
text
@d22 1
@


5.29.6.1
log
@A working set of code against Tcl8.4!
@
text
@@


5.29.4.1
log
@Top-level source files removed.
@
text
@@


5.28
log
@Initial revision
@
text
@d36 1
d43 2
a44 2
	exp_errorlog("expect: spawn: cannot %s console, check permissions of /dev/console\n",s);
	exit(-1);
@


5.28.1.1
log
@Import of Expect v. 5.28.1
@
text
@@


5.28.1.1.2.1
log
@fixed Log/Diag and ExpectCmd
@
text
@d42 2
a43 2
    expErrorLog("expect: spawn: cannot %s console, check permissions of /dev/console\n",s);
    exit(-1);
@


5.28.1.1.2.2
log
@Everything but Dbg.c
@
text
@a35 1
#include "exp_command.h"
@


