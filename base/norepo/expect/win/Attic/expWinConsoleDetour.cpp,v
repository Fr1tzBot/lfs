head	1.1;
access;
symbols
	telco-tec-win32-take2-branch:1.1.0.2;
locks; strict;
comment	@// @;


1.1
date	2002.07.03.02.46.40;	author davygrvy;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2002.07.03.02.46.40;	author davygrvy;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2002.07.03.04.25.36;	author davygrvy;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2002.07.04.23.05.23;	author davygrvy;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2003.08.25.23.17.49;	author davygrvy;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2003.08.26.20.46.52;	author davygrvy;	state dead;
branches;
next	;


desc
@@


1.1
log
@file expWinConsoleDetour.cpp was initially added on branch telco-tec-win32-take2-branch.
@
text
@@


1.1.2.1
log
@framework for experimenting with the "Detours" library added.
@
text
@a0 69
/* ----------------------------------------------------------------------
 * expWinConsoleDetour.cpp --
 *
 *	Console detour core implimentation.  At first, we will use the
 *	"Detours" library provided by Microsoft Research for testing.
 *	We will have to "heavily customize it" later to remove all
 *	copywrite before we can distribute this.
 *
 *	see http://research.microsoft.com/sn/detours/
 *
 * ----------------------------------------------------------------------
 *
 * Written by: Don Libes, libes@@cme.nist.gov, NIST, 12/3/90
 * 
 * Design and implementation of this program was paid for by U.S. tax
 * dollars.  Therefore it is public domain.  However, the author and
 * NIST would appreciate credit if this program or parts of it are used.
 * 
 * Copyright (c) 1997 Mitel Corporation
 *	work by Gordon Chaffee <chaffee@@bmrc.berkeley.edu> for the NT
 *	port.
 *
 * Copyright (c) 2001-2002 Telindustrie, LLC
 *	work by David Gravereaux <davygrvy@@pobox.com> for any Win32 OS.
 *
 * ----------------------------------------------------------------------
 * URLs:    http://expect.nist.gov/
 *	    http://expect.sf.net/
 *	    http://bmrc.berkeley.edu/people/chaffee/expectnt.html
 * ----------------------------------------------------------------------
 * RCS: @@(#) $Id: expWinConsoleDebugger.cpp,v 1.1.2.31 2002/06/29 00:44:35 davygrvy Exp $
 * ----------------------------------------------------------------------
 */

#include "expWinSlave.hpp"


ConsoleDetour::ConsoleDetour (
	int _argc,
	char * const *_argv,
	CMclQueue<Message *> &_mQ)
    : mQ(_mQ)
{
}

ConsoleDetour::~ConsoleDetour ()
{
}

unsigned
ConsoleDetour::ThreadHandlerProc (void)
{
    return 0;
}

void
ConsoleDetour::WriteRecord (INPUT_RECORD *ir)
{
}

void
ConsoleDetour::EnterInteract (HANDLE OutConsole)
{
}

void
ConsoleDetour::ExitInteract (void)
{
}
@


1.1.2.2
log
@A small beginning
@
text
@d9 1
a9 1
 *	see: http://research.microsoft.com/sn/detours/
d31 1
a31 1
 * RCS: @@(#) $Id: expWinConsoleDetour.cpp,v 1.1.2.1 2002/07/03 02:46:40 davygrvy Exp $
a35 209

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_AllocConsole(VOID),
	AllocConsole
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_Beep(DWORD dwFreq, DWORD dwDuration),
	Beep
	);

DETOUR_TRAMPOLINE(
	HANDLE WINAPI Real_CreateConsoleScreenBuffer(
		DWORD dwDesiredAccess,
		DWORD dwShareMode,
		CONST SECURITY_ATTRIBUTES *lpSecurityAttributes,
		DWORD dwFlags,
		LPVOID lpScreenBufferData),
	CreateConsoleScreenBuffer
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_FillConsoleOutputAttribute(
		HANDLE hConsoleOutput,
		WORD wAttribute,
		DWORD nLength,
		COORD  dwWriteCoord,
		LPDWORD lpNumberOfAttrsWritten),
	FillConsoleOutputAttribute
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_FillConsoleOutputCharacterA(
		HANDLE hConsoleOutput,
		CHAR cCharacter,
		DWORD  nLength,
		COORD  dwWriteCoord,
		LPDWORD lpNumberOfCharsWritten),
	FillConsoleOutputCharacterA
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_FillConsoleOutputCharacterW(
		HANDLE hConsoleOutput,
		WCHAR cCharacter,
		DWORD  nLength,
		COORD  dwWriteCoord,
		LPDWORD lpNumberOfCharsWritten),
	FillConsoleOutputCharacterW
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_FreeConsole(VOID),
	FreeConsole
	);

DETOUR_TRAMPOLINE(
	HANDLE WINAPI Real_GetStdHandle(DWORD nStdHandle),
	GetStdHandle
	);

//DETOUR_TRAMPOLINE(BOOL WINAPI Real_OpenConsoleW(???), OpenConsoleW);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_ScrollConsoleScreenBufferA(
		HANDLE hConsoleOutput,
		CONST SMALL_RECT *lpScrollRectangle,
		CONST SMALL_RECT *lpClipRectangle,
		COORD dwDestinationOrigin,
		CONST CHAR_INFO *lpFill),
	ScrollConsoleScreenBufferA
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_ScrollConsoleScreenBufferW(
		HANDLE hConsoleOutput,
		CONST SMALL_RECT *lpScrollRectangle,
		CONST SMALL_RECT *lpClipRectangle,
		COORD dwDestinationOrigin,
		CONST CHAR_INFO *lpFill),
	ScrollConsoleScreenBufferW
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleActiveScreenBuffer(
		HANDLE hConsoleOutput),
	SetConsoleActiveScreenBuffer
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleCP(UINT wCodePageID),
	SetConsoleCP
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleCursorInfo(
		HANDLE hConsoleOutput,
		CONST CONSOLE_CURSOR_INFO *lpConsoleCursorInfo),
	SetConsoleCursorInfo
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleCursorPosition(
		HANDLE hConsoleOutput,
		COORD dwCursorPosition),
	SetConsoleCursorPosition
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleMode(
		HANDLE hConsoleHandle,
		DWORD dwMode),
	SetConsoleMode
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleOutputCP(UINT wCodePageID),
	SetConsoleOutputCP
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleTextAttribute(
		HANDLE hConsoleOutput,
		WORD wAttributes),
	SetConsoleTextAttribute
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_SetConsoleWindowInfo(
		HANDLE hConsoleOutput,
		BOOL bAbsolute,
		CONST SMALL_RECT *lpConsoleWindow),
	SetConsoleWindowInfo
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteConsoleA(
		HANDLE hConsoleOutput,
		CONST VOID *lpBuffer,
		DWORD nNumberOfCharsToWrite,
		LPDWORD lpNumberOfCharsWritten,
		LPVOID lpReserved),
	WriteConsoleA
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteConsoleW(
		HANDLE hConsoleOutput,
		CONST VOID *lpBuffer,
		DWORD nNumberOfCharsToWrite,
		LPDWORD lpNumberOfCharsWritten,
		LPVOID lpReserved),
	WriteConsoleW
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteConsoleOutputA(
		HANDLE hConsoleOutput,
		CONST CHAR_INFO *lpBuffer,
		COORD dwBufferSize,
		COORD dwBufferCoord,
		PSMALL_RECT lpWriteRegion),
	WriteConsoleOutputA
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteConsoleOutputW(
		HANDLE hConsoleOutput,
		CONST CHAR_INFO *lpBuffer,
		COORD dwBufferSize,
		COORD dwBufferCoord,
		PSMALL_RECT lpWriteRegion),
	WriteConsoleOutputW
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteConsoleOutputCharacterA(
		HANDLE hConsoleOutput,
		LPCSTR lpCharacter,
		DWORD nLength,
		COORD dwWriteCoord,
		LPDWORD lpNumberOfCharsWritten),
	WriteConsoleOutputCharacterA
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteConsoleOutputCharacterW(
		HANDLE hConsoleOutput,
		LPCWSTR lpCharacter,
		DWORD nLength,
		COORD dwWriteCoord,
		LPDWORD lpNumberOfCharsWritten),
	WriteConsoleOutputCharacterW
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_WriteFile(
		HANDLE hFile,
		LPCVOID lpBuffer,
		DWORD nNumberOfBytesToWrite,
		LPDWORD lpNumberOfBytesWritten,
		LPOVERLAPPED lpOverlapped),
	WriteFile
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_IsWindowVisible(HWND hWnd),
	IsWindowVisible
	);
@


1.1.2.3
log
@mickeymouse work of setting up the tramopoline functions done, but these,
I think, will have to move over to a DLL we inject, thus having the same
problem the old slave driver had with pass complex info over IPC.  I'm not
sure if this technique will "fly", but worth experimenting with.
@
text
@d6 2
a7 2
 *	We will have to "heavily customize it to our special needs"
 *	later on to remove all copywrite before we can distribute this.
d31 1
a31 1
 * RCS: @@(#) $Id: expWinConsoleDetour.cpp,v 1.1.2.2 2002/07/03 04:25:36 davygrvy Exp $
d38 1
a38 1
	BOOL WINAPI Yours_AllocConsole(VOID),
d43 1
a43 1
	BOOL WINAPI Yours_Beep(DWORD dwFreq, DWORD dwDuration),
d48 1
a48 1
	HANDLE WINAPI Yours_CreateConsoleScreenBuffer(
d58 1
a58 1
	BOOL WINAPI Yours_FillConsoleOutputAttribute(
d68 1
a68 1
	BOOL WINAPI Yours_FillConsoleOutputCharacterA(
d78 1
a78 1
	BOOL WINAPI Yours_FillConsoleOutputCharacterW(
d88 1
a88 1
	BOOL WINAPI Yours_FreeConsole(VOID),
d93 1
a93 1
	HANDLE WINAPI Yours_GetStdHandle(DWORD nStdHandle),
d97 1
a97 1
//DETOUR_TRAMPOLINE(BOOL WINAPI Yours_OpenConsoleW(???), OpenConsoleW);
d100 1
a100 1
	BOOL WINAPI Yours_ScrollConsoleScreenBufferA(
d110 1
a110 1
	BOOL WINAPI Yours_ScrollConsoleScreenBufferW(
d120 1
a120 1
	BOOL WINAPI Yours_SetConsoleActiveScreenBuffer(
d126 1
a126 1
	BOOL WINAPI Yours_SetConsoleCP(UINT wCodePageID),
d131 1
a131 1
	BOOL WINAPI Yours_SetConsoleCursorInfo(
d138 1
a138 1
	BOOL WINAPI Yours_SetConsoleCursorPosition(
d145 1
a145 1
	BOOL WINAPI Yours_SetConsoleMode(
d152 1
a152 1
	BOOL WINAPI Yours_SetConsoleOutputCP(UINT wCodePageID),
d157 1
a157 1
	BOOL WINAPI Yours_SetConsoleTextAttribute(
d164 1
a164 1
	BOOL WINAPI Yours_SetConsoleWindowInfo(
d172 1
a172 1
	BOOL WINAPI Yours_WriteConsoleA(
d182 1
a182 1
	BOOL WINAPI Yours_WriteConsoleW(
d192 1
a192 1
	BOOL WINAPI Yours_WriteConsoleOutputA(
d202 1
a202 1
	BOOL WINAPI Yours_WriteConsoleOutputW(
d212 1
a212 1
	BOOL WINAPI Yours_WriteConsoleOutputCharacterA(
d222 1
a222 1
	BOOL WINAPI Yours_WriteConsoleOutputCharacterW(
d232 1
a232 1
	BOOL WINAPI Yours_WriteFile(
d242 1
a242 1
	BOOL WINAPI Yours_IsWindowVisible(HWND hWnd),
a244 375



BOOL WINAPI
Mine_AllocConsole (VOID)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_AllocConsole();
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_Beep (
	DWORD dwFreq,
	DWORD dwDuration)
{
    // Do nothing, be quiet.
    return TRUE;
}

HANDLE WINAPI
Mine_CreateConsoleScreenBuffer (
	DWORD dwDesiredAccess,
	DWORD dwShareMode,
	CONST SECURITY_ATTRIBUTES *lpSecurityAttributes,
	DWORD dwFlags,
	LPVOID lpScreenBufferData)
{
    HANDLE rv = INVALID_HANDLE_VALUE;
    __try {
        rv = Yours_CreateConsoleScreenBuffer(dwDesiredAccess, dwShareMode,
		lpSecurityAttributes, dwFlags, lpScreenBufferData);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_FillConsoleOutputAttribute(
	HANDLE hConsoleOutput,
	WORD wAttribute,
	DWORD nLength,
	COORD  dwWriteCoord,
	LPDWORD lpNumberOfAttrsWritten)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_FillConsoleOutputAttribute(hConsoleOutput, wAttribute,
		nLength, dwWriteCoord, lpNumberOfAttrsWritten);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_FillConsoleOutputCharacterA(
	HANDLE hConsoleOutput,
	CHAR cCharacter,
	DWORD  nLength,
	COORD  dwWriteCoord,
	LPDWORD lpNumberOfCharsWritten)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_FillConsoleOutputCharacterA(hConsoleOutput, cCharacter,
		nLength, dwWriteCoord, lpNumberOfCharsWritten);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_FillConsoleOutputCharacterW(
	HANDLE hConsoleOutput,
	WCHAR cCharacter,
	DWORD  nLength,
	COORD  dwWriteCoord,
	LPDWORD lpNumberOfCharsWritten)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_FillConsoleOutputCharacterW(hConsoleOutput, cCharacter,
		nLength, dwWriteCoord, lpNumberOfCharsWritten);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_FreeConsole(VOID)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_FreeConsole();
    }
    __finally {}
    return rv;
}

HANDLE WINAPI
Mine_GetStdHandle(DWORD nStdHandle)
{
    HANDLE rv = INVALID_HANDLE_VALUE;
    __try {
        rv = Yours_GetStdHandle(nStdHandle);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_ScrollConsoleScreenBufferA(
	HANDLE hConsoleOutput,
	CONST SMALL_RECT *lpScrollRectangle,
	CONST SMALL_RECT *lpClipRectangle,
	COORD dwDestinationOrigin,
	CONST CHAR_INFO *lpFill)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_ScrollConsoleScreenBufferA(hConsoleOutput, lpScrollRectangle,
		lpClipRectangle, dwDestinationOrigin, lpFill);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_ScrollConsoleScreenBufferW(
	HANDLE hConsoleOutput,
	CONST SMALL_RECT *lpScrollRectangle,
	CONST SMALL_RECT *lpClipRectangle,
	COORD dwDestinationOrigin,
	CONST CHAR_INFO *lpFill)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_ScrollConsoleScreenBufferW(hConsoleOutput, lpScrollRectangle,
		lpClipRectangle, dwDestinationOrigin, lpFill);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleActiveScreenBuffer(HANDLE hConsoleOutput)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleActiveScreenBuffer(hConsoleOutput);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleCP(UINT wCodePageID)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleCP(wCodePageID);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleCursorInfo(
	HANDLE hConsoleOutput,
	CONST CONSOLE_CURSOR_INFO *lpConsoleCursorInfo)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleCursorInfo(hConsoleOutput, lpConsoleCursorInfo);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleCursorPosition(
	HANDLE hConsoleOutput,
	COORD dwCursorPosition)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleCursorPosition(hConsoleOutput, dwCursorPosition);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleMode(
	HANDLE hConsoleHandle,
	DWORD dwMode)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleMode(hConsoleHandle, dwMode);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleOutputCP(UINT wCodePageID)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleOutputCP(wCodePageID);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleTextAttribute(
	HANDLE hConsoleOutput,
	WORD wAttributes)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleTextAttribute(hConsoleOutput, wAttributes);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_SetConsoleWindowInfo(
	HANDLE hConsoleOutput,
	BOOL bAbsolute,
	CONST SMALL_RECT *lpConsoleWindow)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_SetConsoleWindowInfo(hConsoleOutput, bAbsolute,
		lpConsoleWindow);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteConsoleA(
	HANDLE hConsoleOutput,
	CONST VOID *lpBuffer,
	DWORD nNumberOfCharsToWrite,
	LPDWORD lpNumberOfCharsWritten,
	LPVOID lpReserved)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteConsoleA(hConsoleOutput, lpBuffer,
		nNumberOfCharsToWrite, lpNumberOfCharsWritten,
		lpReserved);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteConsoleW(
	HANDLE hConsoleOutput,
	CONST VOID *lpBuffer,
	DWORD nNumberOfCharsToWrite,
	LPDWORD lpNumberOfCharsWritten,
	LPVOID lpReserved)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteConsoleW(hConsoleOutput, lpBuffer,
		nNumberOfCharsToWrite, lpNumberOfCharsWritten,
		lpReserved);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteConsoleOutputA(
	HANDLE hConsoleOutput,
	CONST CHAR_INFO *lpBuffer,
	COORD dwBufferSize,
	COORD dwBufferCoord,
	PSMALL_RECT lpWriteRegion)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteConsoleOutputA(hConsoleOutput, lpBuffer,
		dwBufferSize, dwBufferCoord, lpWriteRegion);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteConsoleOutputW(
	HANDLE hConsoleOutput,
	CONST CHAR_INFO *lpBuffer,
	COORD dwBufferSize,
	COORD dwBufferCoord,
	PSMALL_RECT lpWriteRegion)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteConsoleOutputW(hConsoleOutput, lpBuffer,
		dwBufferSize, dwBufferCoord, lpWriteRegion);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteConsoleOutputCharacterA(
	HANDLE hConsoleOutput,
	LPCSTR lpCharacter,
	DWORD nLength,
	COORD dwWriteCoord,
	LPDWORD lpNumberOfCharsWritten)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteConsoleOutputCharacterA(hConsoleOutput, lpCharacter,
		nLength, dwWriteCoord, lpNumberOfCharsWritten);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteConsoleOutputCharacterW(
	HANDLE hConsoleOutput,
	LPCWSTR lpCharacter,
	DWORD nLength,
	COORD dwWriteCoord,
	LPDWORD lpNumberOfCharsWritten)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteConsoleOutputCharacterW(hConsoleOutput, lpCharacter,
		nLength, dwWriteCoord, lpNumberOfCharsWritten);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_WriteFile(
	HANDLE hFile,
	LPCVOID lpBuffer,
	DWORD nNumberOfBytesToWrite,
	LPDWORD lpNumberOfBytesWritten,
	LPOVERLAPPED lpOverlapped)
{
    BOOL rv = FALSE;
    __try {
        rv = Yours_WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite,
		lpNumberOfBytesWritten, lpOverlapped);
    }
    __finally {}
    return rv;
}

BOOL WINAPI
Mine_IsWindowVisible(HWND hWnd)
{
    return TRUE;
}


@


1.1.2.4
log
@these uncommitted edits have been sitting on my desktop for an eternity.

Adds some MS-DOS support but fails to deliver the required hooks to
succeed.
@
text
@d31 1
a31 1
 * RCS: @@(#) $Id: expWinConsoleDetour.cpp,v 1.1.2.3 2002/07/04 23:05:23 davygrvy Exp $
d38 1
a38 1
	BOOL WINAPI Real_AllocConsole(VOID),
d43 1
a43 1
	BOOL WINAPI Real_Beep(DWORD dwFreq, DWORD dwDuration),
d48 1
a48 1
	HANDLE WINAPI Real_CreateConsoleScreenBuffer(
d58 1
a58 1
	BOOL WINAPI Real_FillConsoleOutputAttribute(
d68 1
a68 1
	BOOL WINAPI Real_FillConsoleOutputCharacterA(
d78 1
a78 1
	BOOL WINAPI Real_FillConsoleOutputCharacterW(
d88 1
a88 1
	BOOL WINAPI Real_FreeConsole(VOID),
d93 1
a93 1
	HANDLE WINAPI Real_GetStdHandle(DWORD nStdHandle),
d97 1
a97 1
//DETOUR_TRAMPOLINE(BOOL WINAPI Real_OpenConsoleW(???), OpenConsoleW);
d100 1
a100 1
	BOOL WINAPI Real_ScrollConsoleScreenBufferA(
d110 1
a110 1
	BOOL WINAPI Real_ScrollConsoleScreenBufferW(
d120 1
a120 1
	BOOL WINAPI Real_SetConsoleActiveScreenBuffer(
d126 1
a126 1
	BOOL WINAPI Real_SetConsoleCP(UINT wCodePageID),
d131 1
a131 1
	BOOL WINAPI Real_SetConsoleCursorInfo(
d138 1
a138 1
	BOOL WINAPI Real_SetConsoleCursorPosition(
d145 1
a145 1
	BOOL WINAPI Real_SetConsoleMode(
d152 1
a152 1
	BOOL WINAPI Real_SetConsoleOutputCP(UINT wCodePageID),
d157 1
a157 1
	BOOL WINAPI Real_SetConsoleTextAttribute(
d164 1
a164 1
	BOOL WINAPI Real_SetConsoleWindowInfo(
d172 1
a172 1
	BOOL WINAPI Real_WriteConsoleA(
d182 1
a182 1
	BOOL WINAPI Real_WriteConsoleW(
d192 1
a192 1
	BOOL WINAPI Real_WriteConsoleOutputA(
d202 1
a202 1
	BOOL WINAPI Real_WriteConsoleOutputW(
d212 1
a212 1
	BOOL WINAPI Real_WriteConsoleOutputCharacterA(
d222 1
a222 1
	BOOL WINAPI Real_WriteConsoleOutputCharacterW(
d232 1
a232 1
	BOOL WINAPI Real_WriteFile(
d242 1
a242 1
	BOOL WINAPI Real_IsWindowVisible(HWND hWnd),
a245 29
DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_CreateProcessA(
		LPCSTR lpApplicationName,
		LPSTR lpCommandLine,
		LPSECURITY_ATTRIBUTES lpProcessAttributes,
		LPSECURITY_ATTRIBUTES lpThreadAttributes,
		BOOL bInheritHandles,
		DWORD dwCreationFlags,
		LPVOID lpEnvironment,
		LPCSTR lpCurrentDirectory,
		LPSTARTUPINFOA lpStartupInfo,
		LPPROCESS_INFORMATION lpProcessInformation),
	CreateProcessA,
	);

DETOUR_TRAMPOLINE(
	BOOL WINAPI Real_CreateProcessW(
		LPCWSTR lpApplicationName,
		LPWSTR lpCommandLine,
		LPSECURITY_ATTRIBUTES lpProcessAttributes,
		LPSECURITY_ATTRIBUTES lpThreadAttributes,
		BOOL bInheritHandles,
		DWORD dwCreationFlags,
		LPVOID lpEnvironment,
		LPCWSTR lpCurrentDirectory,
		LPSTARTUPINFOW lpStartupInfo,
		LPPROCESS_INFORMATION lpProcessInformation),
	CreateProcessW
	);
d253 1
a253 1
        rv = Real_AllocConsole();
d278 1
a278 1
        rv = Real_CreateConsoleScreenBuffer(dwDesiredAccess, dwShareMode,
d295 1
a295 1
        rv = Real_FillConsoleOutputAttribute(hConsoleOutput, wAttribute,
d312 1
a312 1
        rv = Real_FillConsoleOutputCharacterA(hConsoleOutput, cCharacter,
d329 1
a329 1
        rv = Real_FillConsoleOutputCharacterW(hConsoleOutput, cCharacter,
d341 1
a341 1
        rv = Real_FreeConsole();
d352 1
a352 1
        rv = Real_GetStdHandle(nStdHandle);
d368 1
a368 1
        rv = Real_ScrollConsoleScreenBufferA(hConsoleOutput, lpScrollRectangle,
d385 1
a385 1
        rv = Real_ScrollConsoleScreenBufferW(hConsoleOutput, lpScrollRectangle,
d397 1
a397 1
        rv = Real_SetConsoleActiveScreenBuffer(hConsoleOutput);
d408 1
a408 1
        rv = Real_SetConsoleCP(wCodePageID);
d421 1
a421 1
        rv = Real_SetConsoleCursorInfo(hConsoleOutput, lpConsoleCursorInfo);
d434 1
a434 1
        rv = Real_SetConsoleCursorPosition(hConsoleOutput, dwCursorPosition);
d447 1
a447 1
        rv = Real_SetConsoleMode(hConsoleHandle, dwMode);
d458 1
a458 1
        rv = Real_SetConsoleOutputCP(wCodePageID);
d471 1
a471 1
        rv = Real_SetConsoleTextAttribute(hConsoleOutput, wAttributes);
d485 1
a485 1
        rv = Real_SetConsoleWindowInfo(hConsoleOutput, bAbsolute,
d502 1
a502 1
        rv = Real_WriteConsoleA(hConsoleOutput, lpBuffer,
d520 1
a520 1
        rv = Real_WriteConsoleW(hConsoleOutput, lpBuffer,
d538 1
a538 1
        rv = Real_WriteConsoleOutputA(hConsoleOutput, lpBuffer,
d555 1
a555 1
        rv = Real_WriteConsoleOutputW(hConsoleOutput, lpBuffer,
d572 1
a572 1
        rv = Real_WriteConsoleOutputCharacterA(hConsoleOutput, lpCharacter,
d589 1
a589 1
        rv = Real_WriteConsoleOutputCharacterW(hConsoleOutput, lpCharacter,
d606 1
a606 1
        rv = Real_WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite,
a616 52
}

BOOL WINAPI
Mine_CreateProcessW(
	LPCWSTR lpApplicationName,
	LPWSTR lpCommandLine,
	LPSECURITY_ATTRIBUTES lpProcessAttributes,
	LPSECURITY_ATTRIBUTES lpThreadAttributes,
	BOOL bInheritHandles,
	DWORD dwCreationFlags,
	LPVOID lpEnvironment,
	LPCWSTR lpCurrentDirectory,
	LPSTARTUPINFOW lpStartupInfo,
	LPPROCESS_INFORMATION lpProcessInformation)
{
    BOOL rv = FALSE;

    // TODO: new consoles must be created hidden!

    rv = DetourCreateProcessWithDllW(lpApplicationName,
	    lpCommandLine, lpProcessAttributes, lpThreadAttributes,
            bInheritHandles, dwCreationFlags, lpEnvironment,
	    lpCurrentDirectory, lpStartupInfo, lpProcessInformation,
	    L""/*s_wzDllPath*/, Real_CreateProcessW);

    return rv;
}

BOOL WINAPI
Mine_CreateProcessA(
	LPCSTR lpApplicationName,
	LPSTR lpCommandLine,
	LPSECURITY_ATTRIBUTES lpProcessAttributes,
	LPSECURITY_ATTRIBUTES lpThreadAttributes,
	BOOL bInheritHandles,
	DWORD dwCreationFlags,
	LPVOID lpEnvironment,
	LPCSTR lpCurrentDirectory,
	LPSTARTUPINFOA lpStartupInfo,
	LPPROCESS_INFORMATION lpProcessInformation)
{
    BOOL rv = FALSE;

    // TODO: new consoles must be created hidden!

    rv = DetourCreateProcessWithDllA(lpApplicationName,
	    lpCommandLine, lpProcessAttributes, lpThreadAttributes,
            bInheritHandles, dwCreationFlags, lpEnvironment,
	    lpCurrentDirectory, lpStartupInfo, lpProcessInformation,
	    ""/*s_wzDllPath*/, Real_CreateProcessA);

    return rv;
@


1.1.2.5
log
@titleblock comment changes and removal of the Detours library usage.
@
text
@d31 1
a31 1
 * RCS: @@(#) $Id: expWinConsoleDetour.cpp,v 1.1.2.4 2003/08/25 23:17:49 davygrvy Exp $
@


