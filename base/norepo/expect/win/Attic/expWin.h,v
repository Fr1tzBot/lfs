head	1.1;
access;
symbols
	telco-tec-win32-take2-branch:1.1.2.1.0.2
	telco-tec-win32-branch:1.1.0.2;
locks; strict;
comment	@ * @;


1.1
date	2001.09.13.02.01.49;	author davygrvy;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2001.09.13.02.01.49;	author davygrvy;	state Exp;
branches
	1.1.2.1.2.1;
next	1.1.2.2;

1.1.2.2
date	2001.10.11.02.41.47;	author davygrvy;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2001.10.11.03.59.36;	author davygrvy;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2001.10.11.13.29.43;	author davygrvy;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2001.10.26.09.34.34;	author davygrvy;	state Exp;
branches;
next	1.1.2.6;

1.1.2.6
date	2001.11.07.10.04.57;	author davygrvy;	state Exp;
branches;
next	;

1.1.2.1.2.1
date	2001.11.22.08.50.38;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.2;

1.1.2.1.2.2
date	2001.12.17.07.15.05;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.3;

1.1.2.1.2.3
date	2001.12.17.07.28.42;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.4;

1.1.2.1.2.4
date	2001.12.18.00.29.59;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.5;

1.1.2.1.2.5
date	2001.12.18.04.26.02;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.6;

1.1.2.1.2.6
date	2001.12.19.00.38.43;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.7;

1.1.2.1.2.7
date	2001.12.21.12.17.22;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.8;

1.1.2.1.2.8
date	2001.12.22.05.29.22;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.9;

1.1.2.1.2.9
date	2002.02.10.02.59.46;	author davygrvy;	state Exp;
branches;
next	1.1.2.1.2.10;

1.1.2.1.2.10
date	2002.02.10.06.37.25;	author davygrvy;	state dead;
branches;
next	;


desc
@@


1.1
log
@file expWin.h was initially added on branch telco-tec-win32-branch.
@
text
@@


1.1.2.1
log
@snap29 "import"
@
text
@a0 56
/*
 * expWin.h --
 *
 *	Useful definitions for Expect on NT.
 *
 * Copyright (c) 1997 by Mitel, Inc.
 * Copyright (c) 1997 by Gordon Chaffee (chaffee@@home.com)
 *
 * See the file "license.terms" for information on usage and redistribution
 * of this file, and for a DISCLAIMER OF ALL WARRANTIES.
 *
 */

#define EXP_SLAVE_CREATE 'c'
#define EXP_SLAVE_KEY    'k'
#define EXP_SLAVE_MOUSE  'm'
#define EXP_SLAVE_WRITE  'w'
#define EXP_SLAVE_KILL   'x'

/*
 * Define the types of attempts to use to kill the subprocess
 */
#define EXP_KILL_TERMINATE  0x1
#define EXP_KILL_CTRL_C     0x2
#define EXP_KILL_CTRL_BREAK 0x4

#define EXP_LOG(format, args) \
    ExpSyslog("Expect SlaveDriver (%s: %d): " format, __FILE__, __LINE__, args)

/*
 * The following defines identify the various types of applications that 
 * run under windows.  There is special case code for the various types.
 */

#define EXP_APPL_NONE	0
#define EXP_APPL_DOS	1
#define EXP_APPL_WIN3X	2
#define EXP_APPL_WIN32	3

typedef struct {
    Tcl_Channel channelPtr;
    int toWrite;
} ExpSpawnState;

extern DWORD		ExpApplicationType(const char *originalName,
			    char *fullPath, char *imageName);
extern DWORD		ExpCreateProcess(int argc, char **argv,
			    HANDLE inputHandle, HANDLE outputHandle,
			    HANDLE errorHandle, int allocConsole,
			    int hideConsole, int debug, int newProcessGroup,
			    Tcl_Pid *pidPtr, PDWORD globalPidPtr);
EXTERN Tcl_Channel	ExpCreateSpawnChannel _ANSI_ARGS_((Tcl_Interp *,
			    Tcl_Channel chan));
extern void		ExpSyslog TCL_VARARGS(char *,fmt);
extern Tcl_Pid		Exp_WaitPid(Tcl_Pid pid, int *statPtr, int options);
extern void		Exp_KillProcess(Tcl_Pid pid);
@


1.1.2.1.2.1
log
@A working set of code against Tcl8.4!
@
text
@a13 7
#undef TCL_STORAGE_CLASS
#ifdef BUILD_expect
#   define TCL_STORAGE_CLASS DLLEXPORT
#else
#   define TCL_STORAGE_CLASS DLLIMPORT
#endif

@


1.1.2.1.2.2
log
@Changed ExpWinCreateProcess() to support unicode (aka TCHAR at
run-time through Tcl_WinUtfToTchar())
@
text
@d42 4
a45 15
#define EXP_APPL_NONE	    0
#define EXP_APPL_BATCH	    1
#define EXP_APPL_DOS16	    2
#define EXP_APPL_OS2	    3
#define EXP_APPL_OS2DRV	    4
#define EXP_APPL_WIN16	    5
#define EXP_APPL_WIN16DRV   6
#define EXP_APPL_WIN32CUI   7
#define EXP_APPL_WIN32GUI   8
#define EXP_APPL_WIN32DLL   9
#define EXP_APPL_WIN32DRV   10
#define EXP_APPL_WIN64CUI   11
#define EXP_APPL_WIN64GUI   12
#define EXP_APPL_WIN64DLL   13
#define EXP_APPL_WIN64DRV   14
a51 1
extern void		ExpWinProcessInit(void);
d54 1
a54 1
extern DWORD		ExpWinCreateProcess(int argc, char **argv,
@


1.1.2.1.2.3
log
@Changed ExpWinCreateProcess() to support unicode (aka TCHAR at
run-time through Tcl_WinUtfToTchar())
@
text
@d64 2
a65 2
extern DWORD		ExpWinApplicationType(const char *originalName,
			    Tcl_DString *fullPath);
@


1.1.2.1.2.4
log
@OutputDebugString added to the winprocs for the Tchar thing that
Tcl_WinUtfToTChar() does.
@
text
@d63 1
a63 17
typedef struct {
    int useWide;
    HANDLE (WINAPI *createFileProc)(CONST TCHAR *, DWORD, DWORD, 
	    LPSECURITY_ATTRIBUTES, DWORD, DWORD, HANDLE);
    BOOL (WINAPI *createProcessProc)(CONST TCHAR *, TCHAR *, 
	    LPSECURITY_ATTRIBUTES, LPSECURITY_ATTRIBUTES, BOOL, DWORD, 
	    LPVOID, CONST TCHAR *, LPSTARTUPINFO, LPPROCESS_INFORMATION);
    DWORD (WINAPI *getFileAttributesProc)(CONST TCHAR *);
    DWORD (WINAPI *getShortPathNameProc)(CONST TCHAR *, TCHAR *, DWORD); 
    DWORD (WINAPI *searchPathProc)(CONST TCHAR *, CONST TCHAR *, 
	    CONST TCHAR *, DWORD, TCHAR *, TCHAR **);
    VOID (WINAPI *outputDebugStringProc)(LPCTSTR);
} ExpWinProcs;

extern ExpWinProcs *expWinProcs;

extern void		ExpWinInit(void);
a65 2
extern void		BuildCommandLine(CONST char *executable, int argc,
			    char **argv, Tcl_DString *linePtr);
@


1.1.2.1.2.5
log
@First shot at trying to automate VC++ so I can run slavedrv.exe and get
around the "can't debug child processes" issue.
@
text
@d65 1
a65 1
    HANDLE (WINAPI *createFileProc)(LPCTSTR, DWORD, DWORD,
d67 7
a73 7
    BOOL (WINAPI *createProcessProc)(LPCTSTR, LPTSTR, LPSECURITY_ATTRIBUTES,
	    LPSECURITY_ATTRIBUTES, BOOL, DWORD, LPVOID, LPCTSTR, LPSTARTUPINFO,
	    LPPROCESS_INFORMATION);
    DWORD (WINAPI *getFileAttributesProc)(LPCTSTR);
    DWORD (WINAPI *getShortPathNameProc)(LPCTSTR, LPTSTR, DWORD); 
    DWORD (WINAPI *searchPathProc)(LPCTSTR, LPCTSTR, LPCTSTR, DWORD, LPTSTR,
	    LPTSTR *);
a74 2
    DWORD (WINAPI *getModuleFileNameProc)(HMODULE, LPTSTR, DWORD);
    BOOL (WINAPI *setEnvironmentVariableProc)(LPCTSTR, LPCTSTR);
a77 1
extern HMODULE expDllInstance;
a93 1
extern void		ExpWinDbgLaunch(void);
@


1.1.2.1.2.6
log
@Moved expWinProc initting to a new file.  Also realized COM control over the
slavedrv debugger is much more work than antisipated to get right.
@
text
@a76 1
    BOOL (WINAPI *getEnvironmentVariableProc)(LPCTSTR, LPTSTR, DWORD);
@


1.1.2.1.2.7
log
@Second shot (and final) of automating VC++ for the debugger friendly
replacement to CreateProcess().  What a nightmare...
@
text
@a77 2
    LONG (WINAPI *regSetValueExProc)(HKEY, LPCTSTR, DWORD, DWORD, CONST BYTE *,
	    DWORD);
@


1.1.2.1.2.8
log
@Got the spawndrv.exe using Stubs.  Tried to get the extension, but more work
needs to be done first.  Most Expect commands are now in the ::exp
namespace.
@
text
@a85 1
extern void		ExpDynloadTclStubs(void);
@


1.1.2.1.2.9
log
@moved all header files over to a more core style with the beginnings of a
Stubs table.  This work is far from complete.
@
text
@d4 1
a4 1
 *	Useful definitions for Expect on Win32.
a12 2
#ifndef _EXPWINH
#define _EXPWINH
d14 6
d21 5
d27 57
d85 17
a101 1
#endif@


1.1.2.1.2.10
log
@not needed anymore
@
text
@@


1.1.2.2
log
@slavedrv.exe is building..  need to add Stubs startup code.
@
text
@d38 1
a38 2
#define EXP_APPL_WIN32CUI	3
#define EXP_APPL_WIN32GUI	4
a46 1
/* should be TclpCreateProcess */
d52 2
a53 1
extern Tcl_Channel	ExpCreateSpawnChannel (Tcl_Interp *, Tcl_Channel chan);
@


1.1.2.3
log
@slavedrv.exe is building..  need to add Stubs startup code.
@
text
@d47 1
a47 1
			    char *fullPath);
@


1.1.2.4
log
@Added Stubs dynloading stuff.  slavedrv.exe appears to be working thus far,
@
text
@d48 1
a57 3
extern void		ExpInitWinProcessAPI(void);
extern int		ExpDynloadTclStubs(void);

@


1.1.2.5
log
@ExpSyslog() is finally doing what I want.  More work to do, but the
groundwork is now set.
@
text
@d27 2
a28 7
/*
 * Errors and logging
 */
#define FILEPOSINFO			__FILE__ "(" STRINGIFY(__LINE__) ")"
#define EXP_LOG0(errCode)		ExpSyslog(errCode, FILEPOSINFO, 0)
#define EXP_LOG1(errCode, arg1)		ExpSyslog(errCode, FILEPOSINFO, arg1, 0)
#define EXP_LOG2(errCode, arg1, arg2)	ExpSyslog(errCode, FILEPOSINFO, arg1, arg2, 0)
d46 1
a46 1
extern DWORD		ExpApplicationType (const char *originalName,
d48 1
a48 1
extern DWORD		ExpCreateProcess (int argc, char **argv,
d54 5
a58 6
extern void		ExpSyslog TCL_VARARGS(DWORD,arg1);
extern TCHAR*		ExpSyslogGetSysMsg (DWORD);
extern Tcl_Pid		Exp_WaitPid (Tcl_Pid pid, int *statPtr, int options);
extern void		Exp_KillProcess (Tcl_Pid pid);
extern void		ExpInitWinProcessAPI (void);
extern int		ExpDynloadTclStubs (void);
@


1.1.2.6
log
@Numerous changes
@
text
@d46 4
@


