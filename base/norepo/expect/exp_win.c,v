head	5.34;
access;
symbols
	expect_5_45:5.34
	expect_6_branch:5.34.0.2
	expect_5_44_1_15:5.34
	activestate_win32_port_start:5.28.1.1
	telco-tec-win32-take2-branch:5.28.1.1.0.12
	telco-tec-win32-branch:5.28.1.1.0.10
	expect-sf418892-sf439042-branch:5.28.1.1.0.8
	tclpro-1-5-0:5.28.1.1
	tclpro-1-4-1:5.28.1.1
	tclpro-1-4-0:5.28.1.1
	expect-5-32-2:5.28.1.1
	expect-5-32-0:5.28.1.1
	ajuba-ajuba2-2-0:5.28.1.1
	scriptics-sc-2-0-b5:5.28.1.1
	scriptics-sc-2-0-fixed:5.28.1.1
	scriptics-sc-2-0-b2:5.28.1.1
	scriptics-sc-2-0-b1:5.28.1.1
	scriptics-sc-1-1:5.28.1.1
	scriptics-sc-1-1-b1:5.28.1.1
	scriptics-sc-1-1-branch:5.28.1.1.0.6
	scriptics-sc-1-1-base:5.28.1.1
	scriptics-sc-1-0:5.28.1.1
	scriptics-sc-1-0-branch:5.28.1.1.0.4
	scriptics-sc-1-0-base:5.28.1.1
	expect-5-31-3:5.28.1.1
	scriptics-bc-1-0-b1:5.28.1.1
	scriptics-tclpro-1-3-0:5.28.1.1
	scriptics-tclpro-1-3-b4:5.28.1.1
	scriptics-tclpro-1-3-b3:5.28.1.1
	expect-5-31:5.28.1.1
	expect-5-31-branch:5.28.1.1.0.2
	expect-5-31-base:5.28.1.1
	scriptics-tclpro-1-2:5.28.1.1
	scriptics-tclpro-1-2-b2:5.28.1.1
	scriptics-tclpro-1-2-b1:5.28.1.1
	scriptics-tclpro-1-2-a1:5.28.1.1
	expect-5-28-1:5.28.1.1
	expect:5.28.1;
locks; strict;
comment	@ * @;


5.34
date	2010.07.01.00.53.49;	author eee;	state Exp;
branches;
next	5.33;

5.33
date	2010.06.09.22.08.20;	author eee;	state Exp;
branches;
next	5.32;

5.32
date	2010.03.19.16.53.03;	author eee;	state Exp;
branches;
next	5.31;

5.31
date	2010.03.11.21.55.45;	author eee;	state Exp;
branches;
next	5.30;

5.30
date	2008.04.03.19.19.41;	author andreas_kupries;	state Exp;
branches;
next	5.29;

5.29
date	2007.07.11.20.22.10;	author andreas_kupries;	state Exp;
branches;
next	5.28;

5.28
date	98.10.14.22.53.22;	author cvsadmin;	state Exp;
branches
	5.28.1.1;
next	;

5.28.1.1
date	98.10.14.22.53.22;	author cvsadmin;	state Exp;
branches
	5.28.1.1.10.1
	5.28.1.1.12.1;
next	;

5.28.1.1.10.1
date	2001.10.02.23.04.51;	author davygrvy;	state dead;
branches;
next	;

5.28.1.1.12.1
date	2001.11.22.08.50.37;	author davygrvy;	state dead;
branches;
next	;


desc
@@


5.34
log
@Undoing all changes made by me during ANSIfication attempt, and
reverting to tag 'expect_5_44_1_15'.  Further ANSIfication will
be pursued on a branch.
@
text
@/* exp_win.c - window support

Written by: Don Libes, NIST, 10/25/93

This file is in the public domain.  However, the author and NIST
would appreciate credit if you use this file or parts of it.

*/

#include "expect_cf.h"
#include "tcl.h"

#ifdef NO_STDLIB_H
#include "../compat/stdlib.h"
#else
#include <stdlib.h>
#endif

/* _IBCS2 required on some Intel platforms to allow the include files */
/* to produce a definition for winsize. */
#define _IBCS2 1

/*
 * get everyone's window size definitions
 *
note that this is tricky because (of course) everyone puts them in
different places.  Worse, on some systems, some .h files conflict
and cannot both be included even though both exist.  This is the
case, for example, on SunOS 4.1.3 using gcc where termios.h
conflicts with sys/ioctl.h
 */

#ifdef HAVE_TERMIOS
#  include <termios.h>
#else
#  include <sys/ioctl.h>
#endif

/* Sigh.  On AIX 2.3, termios.h exists but does not define TIOCGWINSZ */
/* Instead, it has to come from ioctl.h.  However, As I said above, this */
/* can't be cavalierly included on all machines, even when it exists. */
#if defined(HAVE_TERMIOS) && !defined(HAVE_TIOCGWINSZ_IN_TERMIOS_H)
#  include <sys/ioctl.h>
#endif

/* SCO defines window size structure in PTEM and TIOCGWINSZ in termio.h */
/* Sigh... */
#if defined(HAVE_SYS_PTEM_H)
#   include <sys/types.h>   /* for stream.h's caddr_t */
#   include <sys/stream.h>  /* for ptem.h's mblk_t */
#   include <sys/ptem.h>
#endif /* HAVE_SYS_PTEM_H */

#include "exp_tty_in.h"
#include "exp_win.h"

#ifdef TIOCGWINSZ
typedef struct winsize exp_winsize;
#define columns ws_col
#define rows ws_row
#define EXP_WIN
#endif

#if !defined(EXP_WIN) && defined(TIOCGSIZE)
typedef struct ttysize exp_winsize;
#define columns ts_cols
#define rows ts_lines
#define EXP_WIN
#endif

#if !defined(EXP_WIN)
typedef struct {
	int columns;
	int rows;
} exp_winsize;
#endif

static exp_winsize winsize = {0, 0};
static exp_winsize win2size = {0, 0};

int exp_window_size_set(fd)
int fd;
{
#ifdef TIOCSWINSZ
	ioctl(fd,TIOCSWINSZ,&winsize);
#endif
#if defined(TIOCSSIZE) && !defined(TIOCSWINSZ)
	ioctl(fd,TIOCSSIZE,&winsize);
#endif
}

int exp_window_size_get(fd)
int fd;
{
#ifdef TIOCGWINSZ
	ioctl(fd,TIOCGWINSZ,&winsize);
#endif
#if defined(TIOCGSIZE) && !defined(TIOCGWINSZ)
	ioctl(fd,TIOCGSIZE,&winsize);
#endif
#if !defined(EXP_WIN)
	winsize.rows = 0;
	winsize.columns = 0;
#endif
}

void
exp_win_rows_set(rows)
char *rows;
{
	winsize.rows = atoi(rows);
	exp_window_size_set(exp_dev_tty);
}

char*
exp_win_rows_get()
{
    static char rows [20];
	exp_window_size_get(exp_dev_tty);
	sprintf(rows,"%d",winsize.rows);
    return rows;
}

void
exp_win_columns_set(columns)
char *columns;
{
	winsize.columns = atoi(columns);
	exp_window_size_set(exp_dev_tty);
}

char*
exp_win_columns_get()
{
    static char columns [20];
	exp_window_size_get(exp_dev_tty);
	sprintf(columns,"%d",winsize.columns);
    return columns;
}

/*
 * separate copy of everything above - used for handling user stty requests
 */

int exp_win2_size_set(fd)
int fd;
{
#ifdef TIOCSWINSZ
			ioctl(fd,TIOCSWINSZ,&win2size);
#endif
#if defined(TIOCSSIZE) && !defined(TIOCSWINSZ)
			ioctl(fd,TIOCSSIZE,&win2size);
#endif
}

int exp_win2_size_get(fd)
int fd;
{
#ifdef TIOCGWINSZ
	ioctl(fd,TIOCGWINSZ,&win2size);
#endif
#if defined(TIOCGSIZE) && !defined(TIOCGWINSZ)
	ioctl(fd,TIOCGSIZE,&win2size);
#endif
}

void
exp_win2_rows_set(fd,rows)
int fd;
char *rows;
{
	exp_win2_size_get(fd);
	win2size.rows = atoi(rows);
	exp_win2_size_set(fd);
}

char*
exp_win2_rows_get(fd)
int fd;
{
    static char rows [20];
	exp_win2_size_get(fd);
	sprintf(rows,"%d",win2size.rows);
#if !defined(EXP_WIN)
	win2size.rows = 0;
	win2size.columns = 0;
#endif
    return rows;
}

void
exp_win2_columns_set(fd,columns)
int fd;
char *columns;
{
	exp_win2_size_get(fd);
	win2size.columns = atoi(columns);
	exp_win2_size_set(fd);
}

char*
exp_win2_columns_get(fd)
int fd;
{
    static char columns [20];
	exp_win2_size_get(fd);
	sprintf(columns,"%d",win2size.columns);
    return columns;
}

/*
 * Local Variables:
 * mode: c
 * c-basic-offset: 4
 * fill-column: 78
 * End:
 */
@


5.33
log
@ANSIfication changes.
@
text
@d81 2
a82 1
void exp_window_size_set( int fd)
d92 2
a93 1
void exp_window_size_get( int fd)
d108 2
a109 1
exp_win_rows_set( char *rows)
d116 1
a116 1
exp_win_rows_get(void)
d125 2
a126 1
exp_win_columns_set( char *columns)
d133 1
a133 1
exp_win_columns_get(void)
d145 2
a146 1
int exp_win2_size_set( int fd)
d156 2
a157 1
int exp_win2_size_get( int fd)
d168 3
a170 1
exp_win2_rows_set( int fd, char *rows)
d178 2
a179 1
exp_win2_rows_get( int fd)
d192 2
a193 1
exp_win2_columns_set( int fd)
d202 2
a203 1
exp_win2_columns_get( int fd)
d210 1
a210 1

@


5.32
log
@More ANSIfication
@
text
@d81 1
a81 1
int exp_window_size_set( int fd)
d91 1
a91 1
int exp_window_size_get( int fd)
@


5.31
log
@WHITESPACE CHANGES ONLY. I removed a number of form-feed characters
that had been littered about the source code.
@
text
@d81 1
a81 2
int exp_window_size_set(fd)
int fd;
d91 1
a91 2
int exp_window_size_get(fd)
int fd;
d106 1
a106 2
exp_win_rows_set(rows)
char *rows;
d113 1
a113 1
exp_win_rows_get()
d122 1
a122 2
exp_win_columns_set(columns)
char *columns;
d129 1
a129 1
exp_win_columns_get()
d141 1
a141 2
int exp_win2_size_set(fd)
int fd;
d151 1
a151 2
int exp_win2_size_get(fd)
int fd;
d162 1
a162 3
exp_win2_rows_set(fd,rows)
int fd;
char *rows;
d170 1
a170 2
exp_win2_rows_get(fd)
int fd;
d183 1
a183 2
exp_win2_columns_set(fd,columns)
int fd;
d192 1
a192 2
exp_win2_columns_get(fd)
int fd;
@


5.30
log
@
	* configure.in: Bumped version to 5.44.1.7.
	* configure: Regen'd, autoconf 2.59.

	* The following set of changes was sent our way by Reinhard Max
	  <max@@tclers.tk>.

	* exp_command.c: Fixed more compiler warnings, and started
	* exp_command.h: to ansify the code base, beginning with
	* exp_inter.c: the introduction of proper function prototypes.
	* exp_main_exp.c:
	* exp_pty.h:
	* exp_tty.c:
	* exp_tty.h:
	* exp_win.c:
	* expect.c:
	* pty_termios.c:
	* retoglob.c:
@
text
@d210 1
a210 1

@


5.29
log
@
	* Dbg.c: Cleaned up the direct access to interp->result,
	* exp_command.c: replaced with the proper functions and
	* expect.c: Tcl_Obj's.
	* exp_main_exp.c:
	* exp_main_sub.c:
	* exp_main_tk.c:
	* exp_prog.h:
	* exp_trap.c:
	* exp_tty.c:
	* exp_win.c:
	* exp_win.h:
@
text
@d54 1
a54 1
#include "exp_tty.h"
@


5.28
log
@Initial revision
@
text
@d115 2
a116 3
void
exp_win_rows_get(rows)
char *rows;
d118 1
d121 1
d132 2
a133 3
void
exp_win_columns_get(columns)
char *columns;
d135 1
d138 1
d177 2
a178 2
void
exp_win2_rows_get(fd,rows)
a179 1
char *rows;
d181 1
d188 1
d201 2
a202 2
void
exp_win2_columns_get(fd,columns)
a203 1
char *columns;
d205 1
d208 1
d210 8
@


5.28.1.1
log
@Import of Expect v. 5.28.1
@
text
@@


5.28.1.1.12.1
log
@A working set of code against Tcl8.4!
@
text
@@


5.28.1.1.10.1
log
@Top-level source files removed.
@
text
@@

