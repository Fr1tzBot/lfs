head	1.1;
access;
symbols
	telco-tec-win32-branch:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2001.09.26.14.15.54;	author davygrvy;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2001.09.26.14.15.54;	author davygrvy;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2001.10.11.02.41.47;	author davygrvy;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2001.10.11.03.59.36;	author davygrvy;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2001.10.14.22.15.28;	author davygrvy;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2001.10.22.21.43.54;	author davygrvy;	state Exp;
branches;
next	1.1.2.6;

1.1.2.6
date	2001.10.28.09.06.25;	author davygrvy;	state Exp;
branches;
next	1.1.2.7;

1.1.2.7
date	2001.10.29.02.52.23;	author davygrvy;	state Exp;
branches;
next	1.1.2.8;

1.1.2.8
date	2001.10.30.13.00.46;	author davygrvy;	state Exp;
branches;
next	1.1.2.9;

1.1.2.9
date	2001.11.07.10.04.57;	author davygrvy;	state Exp;
branches;
next	1.1.2.10;

1.1.2.10
date	2001.11.15.07.12.35;	author davygrvy;	state dead;
branches;
next	;


desc
@@


1.1
log
@file makefile.vc32 was initially added on branch telco-tec-win32-branch.
@
text
@@


1.1.2.1
log
@New top-root makefile under windows.
@
text
@a0 44
!include "..\mkfiles.mif"

!if exist(.\mkfiles.d)
!include mkfiles.d
!endif

core : $(EXPTARGET)

$(EXPTARGET) : $(EXPDLL_OBJs)
!if $(STATIC_BUILD)
	lib -nologo -out:$@@ @@<<
!else
	link -nologo -out:$@@ -dll -subsystem:windows -release $(WIN32LIBs) @@<<
!endif
$(EXPDLL_OBJs)
<<

depends : mkfiles.d

#cl -nologo -Zs -P -YX -Fp$(TMP_DIR)^\ -I$(GENERICDIR) -DBUILD_tcl
mkfiles.d :
	@@echo $(TCLSH) $(TOOLSDIR)\mkinfrdeps.tcl -vc32 -out:$@@ $(COMPATDIR) $(GENERICDIR) $(WINDIR) @@<<
$(TCLOBJs)
<<


CFLAGS	= -nologo -MD -Ox -YX -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\

{$(COMPATDIR)}.c{$(TMP_DIR)}.obj ::
    cl -c $(CFLAGS) -DBUILD_tcl -I$(GENERICDIR) @@<<
$<
<<

{$(GENERICDIR)}.c{$(TMP_DIR)}.obj ::
    cl -c $(CFLAGS) -DBUILD_tcl -I$(GENERICDIR) @@<<
$<
<<

{$(WINDIR)}.c{$(TMP_DIR)}.obj ::
    cl -c $(CFLAGS) -DBUILD_tcl -I$(GENERICDIR) @@<<
$<
<<

.SUFFIXES: .c
@


1.1.2.2
log
@slavedrv.exe is building..  need to add Stubs startup code.
@
text
@d1 4
a4 9
!include .\mkconfig.mif
!include .\win\mkvc32.mif
!include .\win\mkfiles.mif
TARGETOS = WINNT
!include <win32.mak>

### Bring in the dependancies if we have them available.
!if exist(.\win\mkfiles.d)
!include .\win\mkfiles.d
d7 1
a7 8
all : setup $(EXPLIB)
slavedrv : setup $(SLAVEDRV)

setup :
	@@if not exist $(TMP_DIR)\nul mkdir $(TMP_DIR) &\
		echo Created directory '$(TMP_DIR)'
	@@if not exist $(OUT_DIR)\nul mkdir $(OUT_DIR) &\
		echo Created directory '$(OUT_DIR)'
d9 1
a9 1
$(EXPLIB) : $(EXPLIB_OBJs)
d13 1
a13 1
	link -nologo -out:$@@ $(dlllflags) $(guilibsdll) @@<<
d15 1
a15 1
$(EXPLIB_OBJs)
a17 7
$(SLAVEDRV) : $(SLAVEDRV_OBJs)
	link -out:$@@ $(conlflags) $(ldebug) $(conlibsdll) $(optlibs) \
	    imagehlp.lib user32.lib $(TCLSTUBSLIB) @@<<
$(SLAVEDRV_OBJs)
<<


d20 1
d23 1
a23 1
$(EXPLIB_OBJs)
d27 1
a27 2
expcflags   = -DBUILD_exp -DTCL_THREADS -DUSE_TCL_STUBS -I$(GENERICDIR) -I$(WINDIR) \
	$(TCL_INCLUDES) -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\
d30 1
a30 1
    cl $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
d35 1
a35 1
    cl $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
d40 1
a40 1
    cl $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
@


1.1.2.3
log
@slavedrv.exe is building..  need to add Stubs startup code.
@
text
@d46 1
a46 1
	$(TCL_INTINCLUDES) -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\
@


1.1.2.4
log
@Changed the build files to be run from the /win directory instead
of the top-root.  This will help get MS project .dsp files working.
@
text
@d1 3
a3 3
!include ..\mkconfig.mif
!include .\mkvc32.mif
!include .\mkfiles.mif
d46 1
a46 1
	$(TCL_INCLUDES) -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\
d49 1
a49 1
    $(cc32) $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
d54 1
a54 1
    $(cc32) $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
d59 1
a59 1
    $(cc32) $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
a61 7

{$(WINDIR)}.rc{$(TMP_DIR)}.res :
	$(rc32) -fo "$@@" -r -i "$(GENERICDIR)" -i "$(TMP_DIR)" $(TCL_INCLUDES) $<


$(TMP_DIR)\spawndrvmc.rc : $(WINDIR)\spawndrvmc.mc
	mc -w -h "$(TMP_DIR)" -r "$(TMP_DIR)" $?
@


1.1.2.5
log
@Needed to include the temp directory in the include path so spawndrvmc.h
is picked-up.
@
text
@d46 1
a46 1
	-I$(TMP_DIR) $(TCL_INCLUDES) -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\
@


1.1.2.6
log
@build instruction changes
@
text
@d4 1
a4 2
TARGETOS = BOTH
APPVER = 4.0
d12 1
a12 1
expect : setup $(EXPLIB)
d25 1
a25 1
	link -nologo -out:$@@ $(dlllflags) $(guilibsdll) $(TCLSTUBSLIB) @@<<
@


1.1.2.7
log
@added the 'genstubs' target
@
text
@d13 1
a13 2
all :	   setup $(EXPLIB) $(SLAVEDRV)
expect :   setup $(EXPLIB)
a44 12
#
# Regenerate the stubs files.
#

!if $(ISTCLINSTALL)
genstubs :
	@@echo Need the Tcl source for the tools\genStubs.tcl script!
!else
genstubs :
	$(TCLSH_PROG) $(TCLROOT)\tools\genStubs.tcl $(GENERICDIR) \
		$(GENERICDIR)\exp.decls
!endif
d47 1
a47 1
	-I$(TMP_DIR) $(TCL_INCLUDES) -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\ -Fd$(TMP_DIR)^\
@


1.1.2.8
log
@added a 'clean' target.
@
text
@d18 1
a18 1
	@@if not exist "$(TMP_DIR)\nul" mkdir "$(TMP_DIR)" &\
d20 1
a20 1
	@@if not exist "$(OUT_DIR)\nul" mkdir "$(OUT_DIR)" &\
a22 1

d27 1
a27 1
	link -nologo -force -out:$@@ $(dlllflags) $(guilibsdll) $(TCLSTUBSLIB) @@<<
a82 56


install :    install-binaries install-libraries install-help

install-binaries :
	@@if not exist "$(SCRIPT_INSTALL_DIR)\nul" mkdir "$(LIB_INSTALL_DIR)" &\
	    echo Created directory '$(SCRIPT_INSTALL_DIR)'
	@@echo installing $(EXPLIBNAME)...
	@@copy /y /b $(EXPLIB) "$(SCRIPT_INSTALL_DIR)" > nul
	@@echo installing $(EXPSTUBLIBNAME)...
	@@copy /y /b $(EXPSTUBLIB) "$(LIB_INSTALL_DIR)" > nul
	@@echo installing headers...
	@@copy /y /a "$(GENERICDIR)\exp.h" \
		    "$(GENERICDIR)\expDecls.h" \
		    "$(GENERICDIR)\expPlatDecls.h" \
		    "$(INCLUDE_INSTALL_DIR)" > nul
	@@echo installing pkgIndex.tcl...
	@@echo package ifneeded Expect $(EXP_DOTVERSION) [list load [file join $$dir $(EXPLIBNAME)] Expect] > \
	    "$(SCRIPT_INSTALL_DIR)\pkgIndex.tcl"

install-libraries :
	@@if not exist "$(LIB_INSTALL_DIR)\nul" mkdir "$(LIB_INSTALL_DIR)" &\
		echo Created directory '$(LIB_INSTALL_DIR)'
	@@copy /y /a "" \
	    "$(EXAMPLE_INSTALL_DIR)" > nul

install-help :
	@@echo installing $(EXPHLPNAME)...
	copy /y /b $(EXPHLP) "$(DOC_INSTALL_DIR)" > nul


clean :
!if "$(OS)" == "Windows_NT"
	del /q $(ObjDir)\*.obj \
	    $(TMP_DIR)\*.pdb \
	    $(TMP_DIR)\*.h   \
	    $(TMP_DIR)\*.lib \
	    $(TMP_DIR)\*.exp \
	    $(TMP_DIR)\*.res \
	    $(OUT_DIR)\*.hlp \
	    $(OUT_DIR)\*.lib \
	    $(OUT_DIR)\*.exe \
	    $(OUT_DIR)\*.dll >nul 2>nul
!else  # Win95 doesn't support "2>" on command line, multiple files on a Del command, or /q
	erase  $(TMP_DIR)\*.obj >nul
	erase  $(TMP_DIR)\*.pdb >nul
	erase  $(TMP_DIR)\*.h   >nul
	erase  $(TMP_DIR)\*.lib >nul
	erase  $(TMP_DIR)\*.exp >nul
	erase  $(TMP_DIR)\*.res >nul
	erase  $(TMP_DIR)\*.hlp >nul
	erase  $(TMP_DIR)\*.lib >nul
	erase  $(TMP_DIR)\*.exe >nul
	erase  $(TMP_DIR)\*.dll >nul
!endif

@


1.1.2.9
log
@Numerous changes
@
text
@d18 1
a18 1
	@@if not exist $(TMP_DIR)\nul mkdir $(TMP_DIR) & \
d20 1
a20 1
	@@if not exist $(OUT_DIR)\nul mkdir $(OUT_DIR) & \
a73 5
    $(cc32) $(cflags) -MD$(DBGX) $(cdebug) $(expcflags) @@<<
$<
<<

{$(WINDIR)}.cpp{$(TMP_DIR)}.obj ::
@


1.1.2.10
log
@old build files removed.
@
text
@@


