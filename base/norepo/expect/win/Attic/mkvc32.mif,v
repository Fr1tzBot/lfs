head	1.1;
access;
symbols
	telco-tec-win32-branch:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2001.09.26.14.24.21;	author davygrvy;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2001.09.26.14.24.21;	author davygrvy;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2001.09.28.02.17.27;	author davygrvy;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2001.10.11.02.41.47;	author davygrvy;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2001.10.11.03.59.36;	author davygrvy;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2001.10.14.22.15.28;	author davygrvy;	state Exp;
branches;
next	1.1.2.6;

1.1.2.6
date	2001.10.30.13.00.46;	author davygrvy;	state Exp;
branches;
next	1.1.2.7;

1.1.2.7
date	2001.11.15.07.12.35;	author davygrvy;	state dead;
branches;
next	;


desc
@@


1.1
log
@file mkvc32.mif was initially added on branch telco-tec-win32-branch.
@
text
@@


1.1.2.1
log
@New top-root makefile under windows.
@
text
@a0 160
#==============================================================================
#
#   Make information file for the Microsoft Visual C++ 32-bit tools.
#
#
#   NMAKE specific syntax is allowed in this file.
#
#==============================================================================
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.5 2001/09/16 07:00:34 davygrvy Exp $
#==============================================================================

!ifndef _MKVC32_MIF
_MKVC32_MIF = 1


#==============================================
# check for local.
#==============================================
!if !exist(.\mkvc32.mif)
!error The current working directory must be Tcl's windows platform directory before running 'makefile.win'
!endif


TOOLSET	    = vc32
MAKECMD	    = nmake.exe -nologo /$(MAKEFLAGS) -f makefile.vc32
SYM	    =

rc32	    = $(RC)
cc32	    = $(CC)
link32	    = link
lib32	    = lib
cvtres32    = cvtres

!ifndef OUT_DIR
OUT_DIR	    = $(TMP_DIR)
!endif


#==============================================
# Are the tools in the path already?
#==============================================

###  Unfortunetly, we can't just source this into the parent
###  environment just once and have it affect all targets.
###  This just isn't UNIX.

!if !defined(MSVCDIR)
!if     $(TOOLSETvc32VER) == 5
vcvars	    = "$(TOOLSETvc32)\vc\bin\vcvars32.bat"
!elseif $(TOOLSETvc32VER) == 6
vcvars	    = "$(TOOLSETvc32)\vc98\bin\vcvars32.bat"
!endif
!message +++ Microsoft Visual C++ tools are NOT in the path and
!message +++    $(vcvars) will be used.


### We now need to recurse back into ourselves to fix the environment,
### then bail on this run.
!if [ $(vcvars) & nmake -nologo /$(MAKEFLAGS) -f makefile.win ] != 0
!endif

BAILOUT = 1

!else
#!message +++ Microsoft Visual C++ tools are in the path.


#==============================================
# Test for compiler features
#==============================================

### Win95 doesn't support "2>&1".
### Anyone got a work-around?

!if [ $(cc32) -c -Zs -TC nul 2>&1 | find "(R)" ] == 0

!if [ $(cc32) -nologo -ZI -c -Zs -TC -Fdtemp nul 2>&1 | find /c "D4002" > nul ] != 0
!message +++ compiler has `edit and continue`
!else
!message +++ compiler doesn't have `edit and continue`
!endif

!if [ $(cc32) -nologo -Ox -c -Zs -TC -Fdtemp nul 2>&1 | find /c "D4002" > nul ] != 0
!message +++ compiler has `optimizations`
!else
!message +++ compiler doesn't have `optimizations`
!endif

### Force a chariage return.
!if [ echo. ] != 0
!endif

### Clean-up temp files after tests.
!if [ @@for %d in (temp.idb temp.pdb) do @@if exist %d erase %d ] != 0
!endif

!else
!error "$(cc32)" is STILL not available in the path.
!endif

#==============================================
# a bug fix needed for VC++ 6.0's nmake tool.
#
# Reset the version *string* back to the integer
# it's supposed to be.  More entries will have
# to be made here for all subsiquent nmake
# releases until Microsoft fixes it.
#
# Please log your displeasure with their product
# by sending an email to blackhole@@microsoft.com
#
_NMAKE_VER  = $(_NMAKE_VER:6.00.8168.0=600)
#==============================================


# Win95 doesn't support "&" on command line.
#MkDest=@@for %d in ($(PLATFORM) $(ObjDir)) do $(COMSPEC) /c if not exist %d md %d

#clean:
# $(MkDest)
#!if "$(OS)" == "Windows_NT"
# del /q $(ObjDir)\*.obj \
#        $(ObjDir)\*.out \
#        $(ObjDir)\*.h   \
#        $(ObjDir)\*.dbg \
#        $(ObjDir)\*.ocx \
#        $(ObjDir)\*.log \
#        $(ObjDir)\*.lib \
#        $(ObjDir)\*.exe \
#        $(ObjDir)\*.dll \
#        $(ObjDir)\*.map \
#        $(ObjDir)\*.res \
#        $(ObjDir)\*.bin \
#        $(ObjDir)\*.lst \
#        $(ObjDir)\*.blt \
#        $(ObjDir)\*.hlp \
#        $(ObjDir)\*.srl \
#        $(ObjDir)\*.exp >NUL 2>NUL
#!else  # Win95 doesn't support "2>" on command line, multiple files on a Del command, or /q
# erase  $(ObjDir)\*.obj >NUL
# erase  $(ObjDir)\*.out >NUL
# erase  $(ObjDir)\*.h   >NUL
# erase  $(ObjDir)\*.dbg >NUL
# erase  $(ObjDir)\*.ocx >NUL
# erase  $(ObjDir)\*.log >NUL
# erase  $(ObjDir)\*.lib >NUL
# erase  $(ObjDir)\*.exe >NUL
# erase  $(ObjDir)\*.dll >NUL
# erase  $(ObjDir)\*.map >NUL
# erase  $(ObjDir)\*.res >NUL
# erase  $(ObjDir)\*.bin >NUL
# erase  $(ObjDir)\*.lst >NUL
# erase  $(ObjDir)\*.blt >NUL
# erase  $(ObjDir)\*.hlp >NUL
# erase  $(ObjDir)\*.srl >NUL
# erase  $(ObjDir)\*.exp >NUL
#!endif  # OS == Windows_NT

!endif
!endif  # _MKVC32_MIF@


1.1.2.2
log
@Moved the makefile prep work to a seperate file.
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.1 2001/09/26 14:24:21 davygrvy Exp $
d15 7
a21 1
!include "mkconfig.mif"
d25 2
a37 3
!ifndef DEBUG
DEBUG		= 0
!endif
d39 3
a41 3
!ifndef STATIC_BUILD
STATIC_BUILD	= 0
!endif
d43 3
a45 3
!ifndef USE_TCL_STUBS
USE_TCL_STUBS	= 1
!endif
d47 5
a51 9
# Set NOMSVCRT to 1 to use libcmt(d).lib instead of the
# dynamic run-time.
#
!ifndef NOMSVCRT
!if $(STATIC_BUILD)
NOMSVCRT	= 1
!else
NOMSVCRT	= 0
!endif
d53 2
a55 3
!if $(STATIC_BUILD) == 0 && $(NOMSVCRT) == 1
!error The static runtime in a loadable (dll) extension is a useless configuration that will cause abnormal and unnecessary code bloat.
!endif
d57 3
a59 6
!if $(DEBUG)
TMPDIRNAMEPREFIX = Debug
DBGX = d
!else
TMPDIRNAMEPREFIX = Release
DBGX =
d62 1
a62 1
TMPDIRNAME	=
a63 4
!if $(STATIC_BUILD)
!if $(NOMSVCRT) == 0
TMPDIRNAME = $(TMPDIRNAMEPREFIX)_StaticX
STCX	= x
d65 1
a65 36
TMPDIRNAME = $(TMPDIRNAMEPREFIX)_Static
STCX	= s
!endif
OUTEXT	= lib
!else
STCX	=
OUTEXT	= dll
!endif

!if "$(TMPDIRNAME)" == ""
TMPDIRNAME	= $(TMPDIRNAMEPREFIX)
!endif

SOURCEROOT	= .
COMPATDIR	= $(SOURCEROOT)\compat
GENERICDIR	= $(SOURCEROOT)\generic
TESTDIR		= $(SOURCEROOT)\tests
TOOLSDIR	= $(SOURCEROOT)\tools
WINDIR		= $(SOURCEROOT)\win
TMP_DIR		= $(WINDIR)\$(TMPDIRNAME)

!ifndef OUT_DIR
OUT_DIR		= $(WINDIR)\$(TMPDIRNAME)
!endif

# Is TCLROOT pointing to the sources or the install ?
#
!if $(ISTCLINSTALL)
TCLSTUBSLIB	= "$(TCLROOT)\lib\tclstub$(TCLMAJOR)$(TCLMINOR).lib"
TCLLIB		= "$(TCLROOT)\lib\tcl$(TCLMAJOR)$(TCLMINOR).lib"
TCLSH_PROG	= "$(TCLROOT)\bin\tclsh$(TCLMAJOR)$(TCLMINOR).exe"
!else
TCLSTUBSLIB	= "$(TCLROOT)\win\$(TMPDIRNAMEPREFIX)\tclstub$(TCLMAJOR)$(TCLMINOR)$(DBGX).lib"
TCLLIB		= "$(TCLROOT)\win\$(TMPDIRNAMEPREFIX)\tcl$(TCLMAJOR)$(TCLMINOR)$(DBGX).lib"
TCLSH_PROG	= "$(TCLROOT)\win\$(TMPDIRNAMEPREFIX)\tclsh$(TCLMAJOR)$(TCLMINOR)$(DBGX).exe"
!endif
a84 1
COPTS	= -Ox
a86 1
COPTS	=
a96 2
CFLAGS	= -nologo -c $(COPTS) -MD$(DBGX) -YX -Fo$(TMP_DIR)^\ -Fp$(TMP_DIR)^\

d159 1
@


1.1.2.3
log
@slavedrv.exe is building..  need to add Stubs startup code.
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.2 2001/09/28 02:17:27 davygrvy Exp $
d30 1
a30 1
!if !defined(DEBUG)
a31 5
NODEBUG		= 1
!elseif $(DEBUG) == 1
!undef NODEBUG
!else
NODEBUG		= 1
a108 5
!if $(ISTCLINSTALL)
TCL_INCLUDES	= -I"$(TCLROOT)\include"
!else
TCL_INCLUDES	= -I"$(TCLROOT)\generic"
!endif
@


1.1.2.4
log
@slavedrv.exe is building..  need to add Stubs startup code.
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.3 2001/10/11 02:41:47 davygrvy Exp $
a115 1
TCL_INTINCLUDES	= -I"$(TCLROOT)\include"
a117 1
TCL_INTINCLUDES	= -I"$(TCLROOT)\generic" -I"$(TCLROOT)\win"
@


1.1.2.5
log
@Changed the build files to be run from the /win directory instead
of the top-root.  This will help get MS project .dsp files working.
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.4 2001/10/11 03:59:36 davygrvy Exp $
d15 1
a15 1
!include ..\mkconfig.mif
d90 1
a90 1
SOURCEROOT	= ..
@


1.1.2.6
log
@added a 'clean' target.
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.5 2001/10/14 22:15:28 davygrvy Exp $
d116 1
d119 1
d173 43
@


1.1.2.7
log
@old build files removed.
@
text
@d9 1
a9 1
# RCS: @@(#) $Id: mkvc32.mif,v 1.1.2.6 2001/10/30 13:00:46 davygrvy Exp $
@


